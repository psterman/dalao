# 豆包图标点击功能测试指南

## 问题描述

用户反馈：当用户点击豆包图标时，需要验证功能是否正常工作。

## 豆包配置信息

### 1. 软件tab配置
**AppSearchSettings.kt**：
```kotlin
AppSearchConfig(
    appId = "doubao",
    appName = "豆包",
    packageName = "com.larus.nova",
    isEnabled = true,
    order = 0,
    iconResId = R.drawable.ic_doubao,
    searchUrl = "https://play.google.com/store/apps/details?id=com.larus.nova",
    category = AppCategory.AI,
    description = "豆包AI助手搜索"
)
```

### 2. PlatformJumpManager配置
**包名映射**：
```kotlin
appName.contains("豆包") -> listOf("com.larus.nova")
```

### 3. SimpleModeActivity配置
**sendToDouBao方法**：
```kotlin
private fun sendToDouBao(query: String) {
    try {
        // 方案1：尝试通过Intent直接发送
        val intent = Intent(Intent.ACTION_SEND).apply {
            type = "text/plain"
            putExtra(Intent.EXTRA_TEXT, query)
            setPackage("com.larus.nova")
            addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
        }
        
        if (intent.resolveActivity(packageManager) != null) {
            startActivity(intent)
            Toast.makeText(this, "正在向豆包发送问题...", Toast.LENGTH_SHORT).show()
            Log.d(TAG, "豆包Intent发送成功")
            return
        }
        
        // 方案2：如果Intent失败，使用剪贴板方案
        sendQuestionViaClipboard("com.larus.nova", query, "豆包")
        
    } catch (e: Exception) {
        Log.e(TAG, "豆包发送失败", e)
        sendQuestionViaClipboard("com.larus.nova", query, "豆包")
    }
}
```

## 豆包图标点击流程

### 1. 软件tab中的豆包图标点击

**流程**：
1. 用户在软件tab输入框中输入问题
2. 点击豆包图标
3. 调用`onAppClick(appConfig, currentQuery)`
4. 执行`handleAIClick(appConfig, query)`
5. 调用`sendToDouBao(query)`

**预期行为**：
- 优先尝试Intent发送：`Intent.ACTION_SEND` + `com.larus.nova`
- 如果Intent失败，使用剪贴板方案
- 显示"正在向豆包发送问题..."提示

### 2. AI回复下方的豆包图标点击

**流程**：
1. 用户在对话tab中发送问题
2. AI回复后显示平台图标
3. 点击豆包图标
4. 调用`PlatformJumpManager.jumpToPlatform("豆包", query)`
5. 识别为AI应用，调用`jumpToAIApp("豆包", query)`
6. 调用`launchAIAppWithIntent("com.larus.nova", query, "豆包")`
7. 调用`launchAppWithAutoPaste("com.larus.nova", query, "豆包")`

**预期行为**：
- 将问题复制到剪贴板
- 启动豆包应用
- 显示"正在启动豆包..."提示
- 2秒后显示悬浮窗指导用户粘贴

## 测试步骤

### 1. 软件tab豆包图标测试

#### 1.1 基础功能测试
1. **进入软件tab**
   - 打开应用，切换到软件tab
   - 切换到AI分类

2. **输入测试问题**
   - 在输入框中输入："你好，请介绍一下自己"
   - 点击豆包图标

3. **验证Intent发送**
   - 如果豆包支持Intent，应该直接打开豆包应用
   - 问题应该自动填入豆包输入框
   - 显示"正在向豆包发送问题..."提示

4. **验证剪贴板备用**
   - 如果Intent失败，应该使用剪贴板方案
   - 显示"已复制问题到剪贴板，请在豆包中粘贴"提示
   - 豆包应用应该启动

#### 1.2 不同问题类型测试
测试以下问题类型：
- 短问题："你好"
- 长问题："请详细解释人工智能的发展历史和未来趋势"
- 包含特殊字符："@#$%^&*()"
- 包含emoji："😊请推荐一些好电影"

### 2. AI回复下方豆包图标测试

#### 2.1 基础功能测试
1. **进入对话tab**
   - 打开应用，进入对话tab
   - 选择任意AI助手

2. **发送测试问题**
   - 在输入框中输入："请推荐几部好看的科幻电影"
   - 点击发送按钮
   - 等待AI回复完成

3. **点击豆包图标**
   - 点击AI回复下方的豆包图标
   - 观察跳转行为

4. **验证软件tab模式**
   - 豆包应用应该启动
   - 显示"正在启动豆包..."提示
   - 等待2秒后显示悬浮窗
   - 悬浮窗指导用户粘贴问题

#### 2.2 悬浮窗功能测试
1. **验证悬浮窗显示**
   - 悬浮窗应该在2秒后显示
   - 悬浮窗应该包含操作指导
   - 悬浮窗应该显示用户的问题

2. **测试悬浮窗功能**
   - 点击悬浮窗中的粘贴按钮
   - 验证问题是否正确粘贴到豆包应用
   - 测试悬浮窗的关闭功能

### 3. 豆包应用安装状态测试

#### 3.1 豆包已安装测试
1. **确认豆包已安装**
   - 检查设备上是否安装了豆包应用
   - 包名：`com.larus.nova`

2. **测试跳转功能**
   - 点击豆包图标
   - 验证豆包应用是否正常启动
   - 验证问题是否正确传递

#### 3.2 豆包未安装测试
1. **卸载豆包应用**
   - 如果已安装，先卸载豆包应用
   - 点击豆包图标

2. **验证错误处理**
   - 应该显示"无法启动豆包，请检查应用是否已安装"提示
   - 不应该崩溃或异常

### 4. Intent发送测试

#### 4.1 Intent支持测试
1. **测试Intent发送**
   - 确保豆包应用已安装
   - 点击豆包图标
   - 验证是否使用Intent发送

2. **验证Intent效果**
   - 豆包应用应该直接打开
   - 问题应该自动填入输入框
   - 用户无需手动操作

#### 4.2 Intent失败测试
1. **模拟Intent失败**
   - 如果豆包不支持Intent发送
   - 应该自动降级到剪贴板方案

2. **验证降级机制**
   - 剪贴板方案应该正常工作
   - 用户提示应该清晰
   - 功能应该仍然可用

### 5. 包名检测测试

#### 5.1 包名正确性测试
1. **验证包名配置**
   - 软件tab：`com.larus.nova`
   - PlatformJumpManager：`com.larus.nova`
   - SimpleModeActivity：`com.larus.nova`

2. **测试包名检测**
   - 验证应用检测是否准确
   - 验证安装状态判断是否正确

#### 5.2 包名变体测试
1. **测试可能的包名变体**
   - `com.larus.nova`（主要包名）
   - `com.volcengine.doubao`（海外版）
   - `com.volcengine.ark`（豆包）
   - `com.volcengine.arklite`（豆包轻量版）

2. **验证包名映射**
   - 确保所有可能的包名都被正确识别
   - 确保包名映射准确

### 6. 图标显示测试

#### 6.1 图标资源测试
1. **验证图标文件**
   - 检查`ic_doubao.xml`是否存在
   - 验证图标资源是否正确

2. **测试图标显示**
   - 软件tab中的豆包图标
   - AI回复下方的豆包图标
   - 验证图标是否正常显示

#### 6.2 图标加载测试
1. **测试图标加载**
   - 验证图标是否正常加载
   - 验证图标大小是否合适
   - 验证图标样式是否一致

2. **测试图标缓存**
   - 验证图标缓存是否正常工作
   - 验证图标加载性能

## 预期结果

### 1. 软件tab豆包图标
- ✅ 点击豆包图标正常响应
- ✅ Intent发送优先尝试
- ✅ 剪贴板备用方案正常
- ✅ 用户提示清晰友好

### 2. AI回复下方豆包图标
- ✅ 豆包应用正常启动
- ✅ 问题复制到剪贴板
- ✅ 悬浮窗正常显示
- ✅ 操作指导清晰

### 3. 包名检测
- ✅ 包名配置正确
- ✅ 应用检测准确
- ✅ 安装状态判断正确

### 4. 图标显示
- ✅ 图标资源存在
- ✅ 图标正常显示
- ✅ 图标样式一致

### 5. 错误处理
- ✅ 完善的异常捕获
- ✅ 友好的错误提示
- ✅ 降级机制正常

## 可能的问题和解决方案

### 1. 豆包应用未安装
**问题**：点击豆包图标后显示"无法启动豆包，请检查应用是否已安装"
**解决方案**：
- 安装豆包应用（包名：`com.larus.nova`）
- 或使用其他已安装的AI应用进行测试

### 2. Intent发送失败
**问题**：豆包不支持Intent发送
**解决方案**：
- 系统会自动降级到剪贴板方案
- 用户需要手动粘贴问题到豆包应用

### 3. 悬浮窗不显示
**问题**：AI回复下方豆包图标点击后悬浮窗不显示
**解决方案**：
- 检查AI应用悬浮窗服务是否正常运行
- 检查权限设置
- 重启应用

### 4. 图标不显示
**问题**：豆包图标不显示或显示异常
**解决方案**：
- 检查`ic_doubao.xml`文件是否存在
- 检查图标资源是否正确
- 清除应用缓存

### 5. 包名检测错误
**问题**：豆包应用检测不准确
**解决方案**：
- 检查包名配置是否正确
- 更新包名映射
- 检查应用安装状态

## 技术细节

### 1. 豆包包名
- **主要包名**：`com.larus.nova`
- **可能变体**：`com.volcengine.doubao`、`com.volcengine.ark`、`com.volcengine.arklite`

### 2. Intent发送
```kotlin
val intent = Intent(Intent.ACTION_SEND).apply {
    type = "text/plain"
    putExtra(Intent.EXTRA_TEXT, query)
    setPackage("com.larus.nova")
    addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
}
```

### 3. 剪贴板方案
```kotlin
val clipboard = getSystemService(Context.CLIPBOARD_SERVICE) as ClipboardManager
val clip = ClipData.newPlainText("AI问题", query)
clipboard.setPrimaryClip(clip)
```

### 4. 悬浮窗服务
```kotlin
val intent = Intent(context, AIAppOverlayService::class.java).apply {
    action = AIAppOverlayService.ACTION_SHOW_OVERLAY
    putExtra(AIAppOverlayService.EXTRA_APP_NAME, "豆包")
    putExtra(AIAppOverlayService.EXTRA_QUERY, query)
    putExtra(AIAppOverlayService.EXTRA_PACKAGE_NAME, "com.larus.nova")
}
```

## 注意事项
- 确保豆包应用已安装（包名：`com.larus.nova`）
- 验证Intent发送是否支持
- 测试剪贴板备用方案
- 检查悬浮窗服务状态
- 验证图标资源完整性
- 测试不同问题类型
- 验证错误处理机制

