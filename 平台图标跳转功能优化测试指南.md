# 平台图标跳转功能优化测试指南

## 优化内容

### 1. 使用用户原始问题作为关键词
- **问题**：用户点击平台图标时，应该使用用户原始的问题作为关键词进行搜索
- **解决方案**：
  - 修改PlatformJumpManager，确保使用用户原始问题作为搜索关键词
  - 优化查询关键词清理逻辑，移除不必要的标点和格式
  - 确保AI回复和平台搜索结果的一致性

### 2. 优化URL Scheme构建逻辑
- **问题**：需要更精准的URL scheme来确保正确跳转到应用内搜索
- **解决方案**：
  - 为每个平台使用专门的URL scheme格式
  - 优化参数编码和URL构建
  - 提供Web搜索作为备选方案

## 测试步骤

### 1. 基础跳转功能测试
1. **进入简易模式**
   - 打开应用，进入简易模式
   - 选择任意AI助手进行对话

2. **发送问题并测试跳转**
   - 发送问题："推荐一些好看的电影"
   - 等待AI回复显示平台图标
   - 点击抖音图标
   - 确认跳转到抖音应用内搜索"推荐一些好看的电影"
   - 检查搜索结果是否与用户问题相关

3. **测试所有平台**
   - 依次点击所有7个平台图标
   - 确认每个平台都使用用户原始问题作为关键词
   - 检查跳转是否成功

### 2. 关键词清理测试
1. **复杂问题测试**
   - 发送问题："【推荐】有什么好看的电影？(最好是科幻片)"
   - 点击平台图标
   - 确认搜索关键词被清理为："推荐 有什么好看的电影 最好是科幻片"
   - 检查清理后的关键词是否合理

2. **特殊字符测试**
   - 发送问题："推荐一些好用的APP！@#$%^&*()"
   - 点击平台图标
   - 确认特殊字符被正确处理
   - 检查搜索关键词是否清晰

3. **长问题测试**
   - 发送很长的问题
   - 点击平台图标
   - 确认关键词被正确清理和截取
   - 检查跳转是否正常

### 3. URL Scheme测试
1. **应用内跳转测试**
   - 确保设备已安装对应应用
   - 点击平台图标
   - 确认使用正确的URL scheme跳转
   - 检查是否直接跳转到应用内搜索页面

2. **Web搜索备选测试**
   - 卸载某个平台应用
   - 点击该平台图标
   - 确认自动跳转到Web搜索
   - 检查Web搜索URL是否正确

3. **URL编码测试**
   - 发送包含中文的问题
   - 点击平台图标
   - 确认URL正确编码
   - 检查搜索关键词是否正确显示

### 4. 不同问题类型测试
1. **视频相关问题**
   - 发送："推荐一些好看的短视频"
   - 点击抖音、快手、哔哩哔哩图标
   - 确认搜索关键词为"推荐一些好看的短视频"
   - 检查搜索结果相关性

2. **美妆相关问题**
   - 发送："有什么好用的护肤品推荐"
   - 点击小红书、抖音图标
   - 确认搜索关键词正确
   - 检查搜索结果质量

3. **学习相关问题**
   - 发送："如何学习编程"
   - 点击哔哩哔哩、YouTube图标
   - 确认搜索关键词正确
   - 检查搜索结果相关性

4. **娱乐相关问题**
   - 发送："推荐一些好听的音乐"
   - 点击抖音、微博图标
   - 确认搜索关键词正确
   - 检查搜索结果质量

### 5. 错误处理测试
1. **网络异常测试**
   - 断网情况下点击平台图标
   - 确认显示适当的错误提示
   - 检查应用稳定性

2. **应用未安装测试**
   - 点击未安装应用的图标
   - 确认自动跳转到Web搜索
   - 检查备选方案是否正常

3. **URL scheme失败测试**
   - 模拟URL scheme跳转失败
   - 确认自动回退到Web搜索
   - 检查错误处理机制

### 6. 用户体验测试
1. **跳转速度测试**
   - 点击平台图标
   - 确认跳转速度合理
   - 检查用户反馈提示

2. **搜索准确性测试**
   - 对比AI回复和平台搜索结果
   - 确认两者内容相关
   - 检查用户体验一致性

3. **多平台对比测试**
   - 对同一问题点击不同平台图标
   - 对比各平台的搜索结果
   - 确认搜索关键词一致性

## 预期结果

### 1. 关键词使用
- ✅ 使用用户原始问题作为搜索关键词
- ✅ 关键词被正确清理和优化
- ✅ 特殊字符和格式被正确处理
- ✅ 长问题被合理截取

### 2. URL Scheme跳转
- ✅ 使用正确的URL scheme格式
- ✅ 应用内跳转成功
- ✅ Web搜索备选方案正常
- ✅ URL编码正确

### 3. 用户体验
- ✅ 跳转速度快
- ✅ 搜索关键词准确
- ✅ 错误处理完善
- ✅ 用户反馈及时

## 技术实现

### 1. 关键词清理
```kotlin
private fun cleanQueryForSearch(query: String): String {
    return query.trim()
        .replace(Regex("[\\[\\](){}【】（）]"), "") // 移除括号
        .replace(Regex("[，。！？,。!?]"), " ") // 替换标点为空格
        .replace(Regex("\\s+"), " ") // 合并多个空格
        .trim()
}
```

### 2. URL Scheme构建
```kotlin
val searchUrl = when (config.packageName) {
    "com.ss.android.ugc.aweme" -> {
        // 抖音：使用snssdk1128://search?keyword=
        "snssdk1128://search?keyword=${Uri.encode(cleanQuery)}"
    }
    "com.xingin.xhs" -> {
        // 小红书：使用xhsdiscover://search?keyword=
        "xhsdiscover://search?keyword=${Uri.encode(cleanQuery)}"
    }
    // 其他平台...
}
```

### 3. 错误处理
```kotlin
try {
    // 尝试应用内跳转
    jumpToApp(config, query)
} catch (e: Exception) {
    Log.e(TAG, "应用内跳转失败，尝试Web搜索", e)
    jumpToWebSearch(config, query)
}
```

## 注意事项
- 确保使用用户原始问题作为搜索关键词
- URL scheme需要根据各平台的实际格式调整
- 提供完善的错误处理和备选方案
- 关键词清理要平衡准确性和可读性
- 测试各种边界情况和异常场景
