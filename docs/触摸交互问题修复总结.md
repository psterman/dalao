# è§¦æ‘¸äº¤äº’é—®é¢˜ä¿®å¤æ€»ç»“

## ğŸ› é—®é¢˜æè¿°

**åŸé—®é¢˜**ï¼šé•¿æŒ‰æœç´¢tabæ¿€æ´»æ‚¬æµ®æ¨¡å¼ï¼Œåªèƒ½æ“ä½œä¸€å¼ ç½®é¡¶çš„å¡ç‰‡ï¼Œå…¶ä»–å¡ç‰‡æ— æ³•æ“ä½œè§¦æ‘¸

**å…·ä½“è¡¨ç°**ï¼š
- é•¿æŒ‰æœç´¢tabåç›´æ¥è¿›å…¥æ‚¬æµ®æ¨¡å¼
- åªæ˜¾ç¤ºä¸€å¼ å¡ç‰‡ï¼Œæ— æ³•çœ‹åˆ°å…¶ä»–å¡ç‰‡
- æ— æ³•é€šè¿‡è§¦æ‘¸æ¥é€‰æ‹©ä¸åŒçš„å¡ç‰‡
- ç¼ºå°‘å±‚å é¢„è§ˆé˜¶æ®µçš„äº¤äº’

## ğŸ¯ æœŸæœ›è¡Œä¸º

æ­£ç¡®çš„äº¤äº’æµç¨‹åº”è¯¥æ˜¯ï¼š
1. **é•¿æŒ‰æœç´¢tab** â†’ æ˜¾ç¤ºæ‰€æœ‰å¡ç‰‡çš„å±‚å é¢„è§ˆ
2. **è§¦æ‘¸ç§»åŠ¨** â†’ å¯ä»¥æ‚¬åœä¸åŒå¡ç‰‡ï¼Œå³è¾¹å¡ç‰‡æ™ºèƒ½æ¨å¼€
3. **æ‰‹æŒ‡æŠ¬èµ·** â†’ è¿›å…¥æ‚¬æµ®æ¨¡å¼ï¼Œæ˜¾ç¤ºå½“å‰æ‚¬åœçš„å¡ç‰‡
4. **æ‚¬æµ®æ“ä½œ** â†’ æ”¯æŒå®Œæ•´çš„æ‰‹åŠ¿æ“ä½œ

## ğŸ” é—®é¢˜æ ¹å› åˆ†æ

### 1. è§¦æ‘¸äº‹ä»¶å¤„ç†é—®é¢˜
- **å±‚å æ¨¡å¼**ï¼š`onTouchEvent`è¿”å›`false`ï¼Œè§¦æ‘¸äº‹ä»¶è¢«ç©¿é€
- **äº¤äº’è®¾ç½®**ï¼š`isClickable = false`ï¼Œæ— æ³•æ¥æ”¶è§¦æ‘¸äº‹ä»¶
- **äº‹ä»¶æ‹¦æˆª**ï¼šSimpleModeActivityæ‹¦æˆªäº†è§¦æ‘¸äº‹ä»¶

### 2. æ¨¡å¼åˆ‡æ¢é€»è¾‘é—®é¢˜
- **ç›´æ¥è·³è½¬**ï¼šæ¿€æ´»åç›´æ¥è¿›å…¥æ‚¬æµ®æ¨¡å¼
- **ç¼ºå°‘é˜¶æ®µ**ï¼šæ²¡æœ‰å±‚å é¢„è§ˆçš„äº¤äº’é˜¶æ®µ
- **çŠ¶æ€ç®¡ç†**ï¼šæ¨¡å¼çŠ¶æ€ç®¡ç†ä¸å®Œæ•´

### 3. å¸ƒå±€è®¾ç½®é—®é¢˜
- **åˆå§‹åŒ–**ï¼šStackedCardPreviewè¢«è®¾ç½®ä¸ºå®Œå…¨ä¸å¯äº¤äº’
- **OnTouchListener**ï¼šè®¾ç½®äº†`{ _, _ -> false }`é˜»æ­¢è§¦æ‘¸

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®æ”¹è§¦æ‘¸äº‹ä»¶å¤„ç†
```kotlin
override fun onTouchEvent(event: MotionEvent): Boolean {
    return if (isFloatingMode) {
        // æ‚¬æµ®æ¨¡å¼ä¸‹å¤„ç†è§¦æ‘¸äº‹ä»¶
        handleFloatingModeTouch(event)
    } else {
        // å±‚å æ¨¡å¼ä¸‹ä¹Ÿå¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œç”¨äºæ‚¬åœäº¤äº’
        handleStackedModeTouch(event)
    }
}
```

### 2. æ·»åŠ å±‚å æ¨¡å¼è§¦æ‘¸å¤„ç†
```kotlin
private fun handleStackedModeTouch(event: MotionEvent): Boolean {
    when (event.action) {
        MotionEvent.ACTION_DOWN -> {
            isTracking = true
            updateFingerPosition(event.x, event.y)
            return true
        }
        MotionEvent.ACTION_MOVE -> {
            if (isTracking) {
                updateFingerPosition(event.x, event.y)
                return true
            }
        }
        MotionEvent.ACTION_UP -> {
            if (hoveredCardIndex >= 0) {
                currentCardIndex = hoveredCardIndex
                enterFloatingMode()
            } else {
                visibility = View.GONE
            }
            return true
        }
    }
    return false
}
```

### 3. ä¿®æ”¹äº¤äº’è®¾ç½®
```kotlin
fun resetToStackedMode() {
    isFloatingMode = false
    // è®¾ç½®ä¸ºå¯äº¤äº’ï¼ˆå±‚å æ¨¡å¼ä¸‹éœ€è¦å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼‰
    isClickable = true
    isFocusable = true
    isEnabled = true
}

fun enableStackedInteraction() {
    if (!isFloatingMode) {
        isClickable = true
        isFocusable = true
        isEnabled = true
        isTracking = false
        hoveredCardIndex = -1
    }
}
```

### 4. ä¿®æ”¹SimpleModeActivityè§¦æ‘¸å¤„ç†
```kotlin
if (isStackedPreviewVisible) {
    // å±‚å é¢„è§ˆæ¨¡å¼ä¸‹ï¼Œè®©StackedCardPreviewè‡ªå·±å¤„ç†è§¦æ‘¸äº‹ä»¶
    Log.d(TAG, "å±‚å é¢„è§ˆå¯è§ï¼Œè®©StackedCardPreviewå¤„ç†è§¦æ‘¸äº‹ä»¶")
    false // ä¸æ‹¦æˆªï¼Œè®©äº‹ä»¶ä¼ é€’ä¸‹å»
} else {
    // æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œå¤„ç†åŸæœ‰çš„æµè§ˆå™¨æ‰‹åŠ¿
    browserGestureDetector.onTouchEvent(event)
    false
}
```

### 5. ä¿®æ”¹åˆå§‹åŒ–è®¾ç½®
```kotlin
stackedCardPreview?.apply {
    // åˆå§‹çŠ¶æ€è®¾ç½®ä¸ºä¸å¯äº¤äº’ï¼Œæ¿€æ´»æ—¶ä¼šé‡æ–°è®¾ç½®
    isClickable = false
    isFocusable = false
    isEnabled = false
    visibility = View.GONE
    
    // ä¸è®¾ç½®OnTouchListenerï¼Œè®©StackedCardPreviewè‡ªå·±å¤„ç†è§¦æ‘¸äº‹ä»¶
}
```

## âœ… ä¿®å¤åçš„å®Œæ•´æµç¨‹

### é˜¶æ®µ1ï¼šæ¿€æ´»å±‚å é¢„è§ˆ
1. **é•¿æŒ‰æœç´¢tab** â†’ `activateStackedCardPreview()`
2. **é‡ç½®æ¨¡å¼** â†’ `resetToStackedMode()` è®¾ç½®`isFloatingMode = false`
3. **å¯ç”¨äº¤äº’** â†’ `enableStackedInteraction()` è®¾ç½®å¯äº¤äº’
4. **æ˜¾ç¤ºé¢„è§ˆ** â†’ `visibility = View.VISIBLE`

### é˜¶æ®µ2ï¼šå±‚å æ¨¡å¼äº¤äº’
1. **è§¦æ‘¸æ£€æµ‹** â†’ `handleStackedModeTouch()` å¤„ç†è§¦æ‘¸äº‹ä»¶
2. **æ‚¬åœæ›´æ–°** â†’ `updateFingerPosition()` å®æ—¶æ›´æ–°æ‚¬åœçŠ¶æ€
3. **æ™ºèƒ½å¸ƒå±€** â†’ å³è¾¹å¡ç‰‡æ¨å¼€ï¼Œæ‚¬åœå¡ç‰‡çªå‡º
4. **æ‰€æœ‰å¡ç‰‡å¯æ“ä½œ** â†’ æ¯å¼ å¡ç‰‡éƒ½å¯ä»¥è¢«æ‚¬åœ

### é˜¶æ®µ3ï¼šè¿›å…¥æ‚¬æµ®æ¨¡å¼
1. **æ‰‹æŒ‡æŠ¬èµ·** â†’ `ACTION_UP` äº‹ä»¶
2. **æ£€æŸ¥æ‚¬åœ** â†’ å¦‚æœæœ‰æ‚¬åœå¡ç‰‡ï¼Œè®¾ç½®`currentCardIndex`
3. **æ¨¡å¼åˆ‡æ¢** â†’ `enterFloatingMode()` åˆ‡æ¢åˆ°æ‚¬æµ®æ¨¡å¼
4. **å•å¡ç‰‡æ˜¾ç¤º** â†’ æ˜¾ç¤ºå½“å‰æ‚¬åœçš„å¡ç‰‡

### é˜¶æ®µ4ï¼šæ‚¬æµ®æ¨¡å¼æ“ä½œ
1. **å®Œæ•´æ‰‹åŠ¿** â†’ æ”¯æŒå·¦å³æ»‘åŠ¨ã€å‘ä¸Šå…³é—­ã€ç‚¹å‡»é€‰æ‹©
2. **å¡ç‰‡åˆ‡æ¢** â†’ å¯ä»¥åˆ‡æ¢åˆ°ä»»æ„å¡ç‰‡
3. **åŠ¨ç”»æ•ˆæœ** â†’ æµç•…çš„åŠ¨ç”»åé¦ˆ

## ğŸ§ª æµ‹è¯•éªŒè¯

### å…³é”®æµ‹è¯•ç‚¹
- [ ] é•¿æŒ‰æœç´¢tabæ˜¾ç¤ºå±‚å é¢„è§ˆï¼ˆä¸æ˜¯ç›´æ¥æ‚¬æµ®ï¼‰
- [ ] å¯ä»¥ç›´æ¥è§¦æ‘¸å±‚å é¢„è§ˆä¸­çš„ä»»æ„å¡ç‰‡
- [ ] æ‰‹æŒ‡ç§»åŠ¨æ—¶æ‚¬åœæ•ˆæœæ­£ç¡®
- [ ] æ‰€æœ‰å¡ç‰‡éƒ½å¯ä»¥è¢«æ‚¬åœå’Œæ“ä½œ
- [ ] æ‰‹æŒ‡æŠ¬èµ·åè¿›å…¥æ‚¬æµ®æ¨¡å¼æ˜¾ç¤ºæ­£ç¡®å¡ç‰‡

### è°ƒè¯•æ—¥å¿—
```
StackedCardPreview: é‡ç½®ä¸ºå±‚å æ¨¡å¼ï¼Œå½“å‰çŠ¶æ€: isFloatingMode=false
StackedCardPreview: å¯ç”¨å±‚å é¢„è§ˆæ¨¡å¼äº¤äº’
StackedCardPreview: å±‚å æ¨¡å¼ - æ‰‹æŒ‡æŒ‰ä¸‹: (x, y)
StackedCardPreview: å±‚å æ¨¡å¼ - æ‰‹æŒ‡ç§»åŠ¨: (x, y)
StackedCardPreview: å±‚å æ¨¡å¼ - æ‰‹æŒ‡æŠ¬èµ·ï¼Œå½“å‰æ‚¬åœå¡ç‰‡: index
StackedCardPreview: è¿›å…¥æ‚¬æµ®æ¨¡å¼ï¼Œæ˜¾ç¤ºå¡ç‰‡: index
```

## ğŸ¯ ä¿®å¤æ•ˆæœ

**ä¿®å¤å‰**ï¼š
- âŒ åªèƒ½æ“ä½œä¸€å¼ ç½®é¡¶å¡ç‰‡
- âŒ æ— æ³•è§¦æ‘¸å…¶ä»–å¡ç‰‡
- âŒ ç¼ºå°‘å±‚å é¢„è§ˆäº¤äº’é˜¶æ®µ

**ä¿®å¤å**ï¼š
- âœ… å¯ä»¥è§¦æ‘¸æ“ä½œæ‰€æœ‰å¡ç‰‡
- âœ… å®Œæ•´çš„å±‚å é¢„è§ˆäº¤äº’
- âœ… æ­£ç¡®çš„æ¨¡å¼åˆ‡æ¢æµç¨‹
- âœ… æ™ºèƒ½çš„æ‚¬åœæ•ˆæœ

ç°åœ¨ç”¨æˆ·å¯ä»¥äº«å—å®Œæ•´çš„å¤šä»»åŠ¡ç®¡ç†ä½“éªŒï¼šå…ˆåœ¨å±‚å é¢„è§ˆä¸­æµè§ˆæ‰€æœ‰å¡ç‰‡ï¼Œé€‰æ‹©æƒ³è¦çš„å¡ç‰‡ï¼Œç„¶åè¿›å…¥æ‚¬æµ®æ¨¡å¼è¿›è¡Œè¯¦ç»†æ“ä½œï¼
