# é˜…è¯»æ¨¡å¼æ»šåŠ¨é€»è¾‘è¯¦ç»†æ¢³ç†

## ğŸ“‹ æ¦‚è¿°

é˜…è¯»æ¨¡å¼çš„æ»šåŠ¨é€»è¾‘ä¸»è¦é€šè¿‡ `setupScrollListener()` æ–¹æ³•å®ç°ï¼Œç›‘å¬ `ScrollView` çš„æ»šåŠ¨äº‹ä»¶ï¼Œæ ¹æ®æ»šåŠ¨æ–¹å‘å’Œä½ç½®è‡ªåŠ¨æ§åˆ¶UIå±‚çš„æ˜¾ç¤º/éšè—ã€‚

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. çŠ¶æ€å˜é‡

```kotlin
// æ»šåŠ¨æ§åˆ¶ç›¸å…³å˜é‡
private var lastScrollY = 0              // è®°å½•ä¸Šä¸€æ¬¡çš„æ»šåŠ¨ä½ç½®
private var isAutoHiding = false         // é˜²æ­¢é‡å¤è§¦å‘éšè—/æ˜¾ç¤ºåŠ¨ç”»
private val scrollThreshold = 10         // æ»šåŠ¨é˜ˆå€¼ï¼ˆåƒç´ ï¼‰ï¼Œé¿å…å°å¹…åº¦æ»‘åŠ¨è§¦å‘UIå˜åŒ–
private var isMenuVisible = false        // UIå±‚å½“å‰æ˜¯å¦å¯è§
```

### 2. UIå±‚å¼•ç”¨

```kotlin
private var topBar: RelativeLayout? = null      // é¡¶éƒ¨å·¥å…·æ 
private var bottomBar: LinearLayout? = null     // åº•éƒ¨å·¥å…·æ 
private var chapterNav: LinearLayout? = null    // ç« èŠ‚å¯¼èˆªå±‚
private var scrollView: ScrollView? = null      // æ»šåŠ¨è§†å›¾
```

---

## ğŸ“Š æ»šåŠ¨é€»è¾‘æµç¨‹å›¾

```
ç”¨æˆ·æ»‘åŠ¨é¡µé¢
    â†“
ScrollView.onScrollChanged è§¦å‘
    â†“
è·å–å½“å‰æ»šåŠ¨ä½ç½® currentScrollY
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠŸèƒ½1: æ£€æŸ¥æ˜¯å¦åˆ°è¾¾åº•éƒ¨              â”‚
â”‚ if (è·ç¦»åº•éƒ¨ < 500px)                â”‚
â”‚    â†’ è‡ªåŠ¨åŠ è½½ä¸‹ä¸€ç«                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠŸèƒ½2: è®¡ç®—æ»šåŠ¨å¢é‡                  â”‚
â”‚ scrollDelta = currentScrollY - lastScrollY â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠŸèƒ½3: åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼              â”‚
â”‚ if (|scrollDelta| > 10px)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â”œâ”€â†’ scrollDelta > 0 (å‘ä¸‹æ»‘åŠ¨)
    â”‚       â†“
    â”‚   if (UIå¯è§ && ä¸åœ¨åŠ¨ç”»ä¸­)
    â”‚       â†“
    â”‚   éšè—æ‰€æœ‰UIå±‚ (hideUIBars)
    â”‚
    â””â”€â†’ scrollDelta < 0 (å‘ä¸Šæ»‘åŠ¨)
            â†“
        if (UIéšè— && ä¸åœ¨åŠ¨ç”»ä¸­)
            â†“
        æ˜¾ç¤ºæ‰€æœ‰UIå±‚ (showUIBars)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠŸèƒ½4: è¾¹ç•Œå¤„ç†                      â”‚
â”‚ if (currentScrollY <= 0)             â”‚
â”‚    â†’ å¼ºåˆ¶æ˜¾ç¤ºUIå±‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æ›´æ–° lastScrollY = currentScrollY
```

---

## ğŸ¯ è¯¦ç»†é€»è¾‘è¯´æ˜

### åŠŸèƒ½1: è‡ªåŠ¨åŠ è½½ä¸‹ä¸€ç« 

**è§¦å‘æ¡ä»¶**ï¼š
- æ»šåŠ¨åˆ°è·ç¦»åº•éƒ¨å°äº 500px

**å®ç°ä»£ç **ï¼š
```kotlin
// 1. æ£€æŸ¥æ˜¯å¦æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œè‡ªåŠ¨åŠ è½½ä¸‹ä¸€ç« 
val child = view.getChildAt(0)
if (child != null) {
    val diff = (child.bottom - (view.height + currentScrollY))
    // å¦‚æœè·ç¦»åº•éƒ¨å°äº 500pxï¼ŒåŠ è½½ä¸‹ä¸€ç« 
    if (diff < 500) {
        manager.loadNextChapter()
    }
}
```

**è®¡ç®—è¯´æ˜**ï¼š
- `child.bottom`: ScrollView å†…å®¹çš„æ€»é«˜åº¦
- `view.height`: ScrollView å¯è§åŒºåŸŸé«˜åº¦
- `currentScrollY`: å½“å‰æ»šåŠ¨ä½ç½®
- `diff = child.bottom - (view.height + currentScrollY)`: è·ç¦»åº•éƒ¨çš„è·ç¦»

**ç¤ºä¾‹**ï¼š
```
å†…å®¹æ€»é«˜åº¦: 2000px
å¯è§é«˜åº¦: 800px
å½“å‰æ»šåŠ¨ä½ç½®: 1300px
è·ç¦»åº•éƒ¨ = 2000 - (800 + 1300) = -100px (å·²è¶…è¿‡åº•éƒ¨)
æˆ–
å½“å‰æ»šåŠ¨ä½ç½®: 800px
è·ç¦»åº•éƒ¨ = 2000 - (800 + 800) = 400px (è·ç¦»åº•éƒ¨400pxï¼Œè§¦å‘åŠ è½½)
```

---

### åŠŸèƒ½2: æ»‘åŠ¨æ–¹å‘æ£€æµ‹

**æ ¸å¿ƒå˜é‡**ï¼š
```kotlin
val scrollDelta = currentScrollY - lastScrollY
```

**æ–¹å‘åˆ¤æ–­**ï¼š
- `scrollDelta > 0`: **å‘ä¸‹æ»‘åŠ¨**ï¼ˆé¡µé¢å†…å®¹å‘ä¸Šç§»åŠ¨ï¼‰
  - ç”¨æˆ·æ­£åœ¨é˜…è¯»ï¼Œéœ€è¦æ²‰æµ¸å¼ä½“éªŒ
  - æ“ä½œï¼šéšè—æ‰€æœ‰UIå±‚
  
- `scrollDelta < 0`: **å‘ä¸Šæ»‘åŠ¨**ï¼ˆé¡µé¢å†…å®¹å‘ä¸‹ç§»åŠ¨ï¼‰
  - ç”¨æˆ·å¯èƒ½éœ€è¦è®¿é—®æ§åˆ¶åŠŸèƒ½
  - æ“ä½œï¼šæ˜¾ç¤ºæ‰€æœ‰UIå±‚

**ç¤ºä¾‹**ï¼š
```
åˆå§‹ä½ç½®: lastScrollY = 100px
å‘ä¸‹æ»‘åŠ¨å: currentScrollY = 150px
scrollDelta = 150 - 100 = 50 > 0 â†’ å‘ä¸‹æ»‘åŠ¨ â†’ éšè—UI

å‘ä¸Šæ»‘åŠ¨å: currentScrollY = 80px
scrollDelta = 80 - 150 = -70 < 0 â†’ å‘ä¸Šæ»‘åŠ¨ â†’ æ˜¾ç¤ºUI
```

---

### åŠŸèƒ½3: é˜²æŠ–åŠ¨æœºåˆ¶

**ç›®çš„**ï¼šé¿å…å°å¹…åº¦æ»‘åŠ¨å¯¼è‡´UIé¢‘ç¹åˆ‡æ¢

**é˜ˆå€¼è®¾ç½®**ï¼š
```kotlin
private val scrollThreshold = 10  // 10åƒç´ 
```

**åˆ¤æ–­é€»è¾‘**ï¼š
```kotlin
if (kotlin.math.abs(scrollDelta) > scrollThreshold) {
    // åªæœ‰æ»šåŠ¨è·ç¦»è¶…è¿‡10pxæ‰è§¦å‘UIå˜åŒ–
    when {
        scrollDelta > 0 -> hideUIBars()
        scrollDelta < 0 -> showUIBars()
    }
}
```

**é˜²æ­¢é‡å¤è§¦å‘**ï¼š
```kotlin
private var isAutoHiding = false

// åœ¨ hideUIBars() å’Œ showUIBars() å¼€å§‹æ—¶æ£€æŸ¥
if (isAutoHiding) return
isAutoHiding = true

// åœ¨åŠ¨ç”»ç»“æŸåé‡ç½®
.withEndAction {
    isAutoHiding = false
}
```

**ç¤ºä¾‹åœºæ™¯**ï¼š
```
åœºæ™¯1: å°å¹…åº¦æ»‘åŠ¨
scrollDelta = 5px â†’ |5| < 10 â†’ ä¸è§¦å‘UIå˜åŒ– âœ“

åœºæ™¯2: æ­£å¸¸æ»‘åŠ¨
scrollDelta = 50px â†’ |50| > 10 â†’ è§¦å‘UIéšè— âœ“

åœºæ™¯3: åŠ¨ç”»è¿›è¡Œä¸­å†æ¬¡æ»‘åŠ¨
isAutoHiding = true â†’ ç›´æ¥è¿”å›ï¼Œä¸è§¦å‘æ–°åŠ¨ç”» âœ“
```

---

### åŠŸèƒ½4: è¾¹ç•Œå¤„ç†

**é¡¶éƒ¨è¾¹ç•Œ**ï¼š
```kotlin
// ç‰¹æ®Šæƒ…å†µï¼šæ»šåŠ¨åˆ°é¡¶éƒ¨æ—¶ï¼Œå¼ºåˆ¶æ˜¾ç¤ºå·¥å…·æ 
if (currentScrollY <= 0 && !isMenuVisible) {
    showUIBars()
}
```

**åŸå› **ï¼š
- ç”¨æˆ·æ»šåŠ¨åˆ°é¡¶éƒ¨é€šå¸¸è¡¨ç¤ºæƒ³è¦æŸ¥çœ‹æ ‡é¢˜æˆ–è®¿é—®æ§åˆ¶åŠŸèƒ½
- å¼ºåˆ¶æ˜¾ç¤ºUIæå‡ç”¨æˆ·ä½“éªŒ

**åº•éƒ¨è¾¹ç•Œ**ï¼š
- é€šè¿‡è‡ªåŠ¨åŠ è½½ä¸‹ä¸€ç« å®ç°æ— ç¼é˜…è¯»
- ä¸éœ€è¦ç‰¹æ®Šçš„UIæ˜¾ç¤ºé€»è¾‘

---

## ğŸ¬ UIåŠ¨ç”»è¯¦è§£

### éšè—åŠ¨ç”» (hideUIBars)

#### 1. é¡¶éƒ¨å·¥å…·æ 
```kotlin
topBar?.animate()
    ?.alpha(0f)                              // é€æ˜åº¦: 1.0 â†’ 0.0
    ?.translationY(-topBar!!.height.toFloat()) // å‘ä¸Šç§»åŠ¨ä¸€ä¸ªè‡ªèº«é«˜åº¦
    ?.setDuration(200)                       // åŠ¨ç”»æ—¶é•¿: 200ms
    ?.withEndAction {
        topBar?.visibility = View.GONE       // åŠ¨ç”»ç»“æŸåè®¾ç½®ä¸ºä¸å¯è§
        isAutoHiding = false                 // é‡ç½®åŠ¨ç”»æ ‡å¿—
    }
    ?.start()
```

**è§†è§‰æ•ˆæœ**ï¼š
- å·¥å…·æ é€æ¸å˜é€æ˜
- åŒæ—¶å‘ä¸Šæ»‘å‡ºå±å¹•
- 200msåå®Œå…¨æ¶ˆå¤±

#### 2. ç« èŠ‚å¯¼èˆªå±‚
```kotlin
chapterNav?.animate()
    ?.alpha(0f)                                  // é€æ˜åº¦: 1.0 â†’ 0.0
    ?.translationY(chapterNav!!.height.toFloat()) // å‘ä¸‹ç§»åŠ¨ä¸€ä¸ªè‡ªèº«é«˜åº¦
    ?.setDuration(200)                           // åŠ¨ç”»æ—¶é•¿: 200ms
    ?.withEndAction {
        chapterNav?.visibility = View.GONE       // åŠ¨ç”»ç»“æŸåè®¾ç½®ä¸ºä¸å¯è§
    }
    ?.start()
```

**è§†è§‰æ•ˆæœ**ï¼š
- å¯¼èˆªå±‚é€æ¸å˜é€æ˜
- åŒæ—¶å‘ä¸‹æ»‘å‡ºå±å¹•
- 200msåå®Œå…¨æ¶ˆå¤±

#### 3. åº•éƒ¨å·¥å…·æ 
```kotlin
bottomBar?.animate()
    ?.alpha(0f)                                  // é€æ˜åº¦: 1.0 â†’ 0.0
    ?.translationY(bottomBar!!.height.toFloat()) // å‘ä¸‹ç§»åŠ¨ä¸€ä¸ªè‡ªèº«é«˜åº¦
    ?.setDuration(200)                           // åŠ¨ç”»æ—¶é•¿: 200ms
    ?.withEndAction {
        bottomBar?.visibility = View.GONE        // åŠ¨ç”»ç»“æŸåè®¾ç½®ä¸ºä¸å¯è§
    }
    ?.start()
```

**è§†è§‰æ•ˆæœ**ï¼š
- å·¥å…·æ é€æ¸å˜é€æ˜
- åŒæ—¶å‘ä¸‹æ»‘å‡ºå±å¹•
- 200msåå®Œå…¨æ¶ˆå¤±

---

### æ˜¾ç¤ºåŠ¨ç”» (showUIBars)

#### 1. é¡¶éƒ¨å·¥å…·æ 
```kotlin
topBar?.apply {
    visibility = View.VISIBLE                // å…ˆè®¾ç½®ä¸ºå¯è§
    alpha = 0f                               // åˆå§‹é€æ˜åº¦: 0.0
    translationY = -height.toFloat()         // åˆå§‹ä½ç½®: ä¸Šæ–¹ï¼ˆå±å¹•å¤–ï¼‰
    animate()
        .alpha(1f)                           // ç›®æ ‡é€æ˜åº¦: 1.0
        .translationY(0f)                    // ç›®æ ‡ä½ç½®: åŸä½
        .setDuration(200)                    // åŠ¨ç”»æ—¶é•¿: 200ms
        .withEndAction {
            isAutoHiding = false             // é‡ç½®åŠ¨ç”»æ ‡å¿—
        }
        .start()
}
```

**è§†è§‰æ•ˆæœ**ï¼š
- å·¥å…·æ ä»ä¸Šæ–¹æ»‘å…¥
- åŒæ—¶é€æ¸å˜ä¸ºä¸é€æ˜
- 200msåå®Œå…¨æ˜¾ç¤º

#### 2. ç« èŠ‚å¯¼èˆªå±‚
```kotlin
chapterNav?.apply {
    visibility = View.VISIBLE                // å…ˆè®¾ç½®ä¸ºå¯è§
    alpha = 0f                               // åˆå§‹é€æ˜åº¦: 0.0
    translationY = height.toFloat()          // åˆå§‹ä½ç½®: ä¸‹æ–¹ï¼ˆå±å¹•å¤–ï¼‰
    animate()
        .alpha(1f)                           // ç›®æ ‡é€æ˜åº¦: 1.0
        .translationY(0f)                    // ç›®æ ‡ä½ç½®: åŸä½
        .setDuration(200)                    // åŠ¨ç”»æ—¶é•¿: 200ms
        .start()
}
```

**è§†è§‰æ•ˆæœ**ï¼š
- å¯¼èˆªå±‚ä»ä¸‹æ–¹æ»‘å…¥
- åŒæ—¶é€æ¸å˜ä¸ºä¸é€æ˜
- 200msåå®Œå…¨æ˜¾ç¤º

#### 3. åº•éƒ¨å·¥å…·æ 
```kotlin
bottomBar?.apply {
    visibility = View.VISIBLE                // å…ˆè®¾ç½®ä¸ºå¯è§
    alpha = 0f                               // åˆå§‹é€æ˜åº¦: 0.0
    translationY = height.toFloat()          // åˆå§‹ä½ç½®: ä¸‹æ–¹ï¼ˆå±å¹•å¤–ï¼‰
    animate()
        .alpha(1f)                           // ç›®æ ‡é€æ˜åº¦: 1.0
        .translationY(0f)                    // ç›®æ ‡ä½ç½®: åŸä½
        .setDuration(200)                    // åŠ¨ç”»æ—¶é•¿: 200ms
        .start()
}
```

**è§†è§‰æ•ˆæœ**ï¼š
- å·¥å…·æ ä»ä¸‹æ–¹æ»‘å…¥
- åŒæ—¶é€æ¸å˜ä¸ºä¸é€æ˜
- 200msåå®Œå…¨æ˜¾ç¤º

---

## ğŸ”„ å®Œæ•´äº¤äº’æµç¨‹ç¤ºä¾‹

### åœºæ™¯1: ç”¨æˆ·å‘ä¸‹æ»‘åŠ¨é˜…è¯»

```
1. ç”¨æˆ·æ‰‹æŒ‡å‘ä¸Šæ»‘åŠ¨å±å¹•ï¼ˆå†…å®¹å‘ä¸‹æ»šåŠ¨ï¼‰
   â†“
2. ScrollView æ£€æµ‹åˆ°æ»šåŠ¨
   currentScrollY: 100px â†’ 200px
   scrollDelta = 200 - 100 = 100px
   â†“
3. åˆ¤æ–­: |100| > 10 âœ“ ä¸” scrollDelta > 0 âœ“
   â†“
4. æ£€æŸ¥: isMenuVisible = true âœ“ ä¸” isAutoHiding = false âœ“
   â†“
5. è°ƒç”¨ hideUIBars()
   â†“
6. è®¾ç½® isAutoHiding = true, isMenuVisible = false
   â†“
7. å¯åŠ¨ä¸‰å±‚UIçš„éšè—åŠ¨ç”»ï¼ˆ200msï¼‰
   - é¡¶éƒ¨å·¥å…·æ : å‘ä¸Šæ»‘å‡º + æ·¡å‡º
   - ç« èŠ‚å¯¼èˆªå±‚: å‘ä¸‹æ»‘å‡º + æ·¡å‡º
   - åº•éƒ¨å·¥å…·æ : å‘ä¸‹æ»‘å‡º + æ·¡å‡º
   â†“
8. åŠ¨ç”»ç»“æŸå
   - è®¾ç½® visibility = GONE
   - é‡ç½® isAutoHiding = false
   â†“
9. æ›´æ–° lastScrollY = 200px
   â†“
10. ç”¨æˆ·è·å¾—æ²‰æµ¸å¼é˜…è¯»ä½“éªŒ âœ“
```

---

### åœºæ™¯2: ç”¨æˆ·å‘ä¸Šæ»‘åŠ¨æŸ¥çœ‹æ§åˆ¶

```
1. ç”¨æˆ·æ‰‹æŒ‡å‘ä¸‹æ»‘åŠ¨å±å¹•ï¼ˆå†…å®¹å‘ä¸Šæ»šåŠ¨ï¼‰
   â†“
2. ScrollView æ£€æµ‹åˆ°æ»šåŠ¨
   currentScrollY: 200px â†’ 150px
   scrollDelta = 150 - 200 = -50px
   â†“
3. åˆ¤æ–­: |-50| > 10 âœ“ ä¸” scrollDelta < 0 âœ“
   â†“
4. æ£€æŸ¥: isMenuVisible = false âœ“ ä¸” isAutoHiding = false âœ“
   â†“
5. è°ƒç”¨ showUIBars()
   â†“
6. è®¾ç½® isAutoHiding = true, isMenuVisible = true
   â†“
7. å¯åŠ¨ä¸‰å±‚UIçš„æ˜¾ç¤ºåŠ¨ç”»ï¼ˆ200msï¼‰
   - é¡¶éƒ¨å·¥å…·æ : ä»ä¸Šæ–¹æ»‘å…¥ + æ·¡å…¥
   - ç« èŠ‚å¯¼èˆªå±‚: ä»ä¸‹æ–¹æ»‘å…¥ + æ·¡å…¥
   - åº•éƒ¨å·¥å…·æ : ä»ä¸‹æ–¹æ»‘å…¥ + æ·¡å…¥
   â†“
8. åŠ¨ç”»ç»“æŸå
   - é‡ç½® isAutoHiding = false
   â†“
9. æ›´æ–° lastScrollY = 150px
   â†“
10. ç”¨æˆ·å¯ä»¥è®¿é—®æ‰€æœ‰æ§åˆ¶åŠŸèƒ½ âœ“
```

---

### åœºæ™¯3: æ»šåŠ¨åˆ°é¡¶éƒ¨

```
1. ç”¨æˆ·æŒç»­å‘ä¸Šæ»‘åŠ¨
   currentScrollY: 50px â†’ 0px
   â†“
2. æ£€æµ‹åˆ° currentScrollY <= 0
   â†“
3. åˆ¤æ–­: isMenuVisible = false
   â†“
4. å¼ºåˆ¶è°ƒç”¨ showUIBars()
   â†“
5. æ˜¾ç¤ºæ‰€æœ‰UIå±‚
   â†“
6. ç”¨æˆ·å¯ä»¥çœ‹åˆ°æ ‡é¢˜å’Œæ§åˆ¶åŠŸèƒ½ âœ“
```

---

### åœºæ™¯4: æ»šåŠ¨åˆ°åº•éƒ¨

```
1. ç”¨æˆ·æŒç»­å‘ä¸‹æ»‘åŠ¨
   currentScrollY: 1200px â†’ 1500px
   â†“
2. è®¡ç®—è·ç¦»åº•éƒ¨
   diff = 2000 - (800 + 1500) = -300px
   â†“
3. åˆ¤æ–­: diff < 500 âœ“
   â†“
4. è°ƒç”¨ manager.loadNextChapter()
   â†“
5. åŠ è½½ä¸‹ä¸€ç« å†…å®¹
   â†“
6. å†…å®¹æ— ç¼è¿½åŠ åˆ°åº•éƒ¨
   â†“
7. ç”¨æˆ·å¯ä»¥ç»§ç»­é˜…è¯» âœ“
```

---

## ğŸ¨ åŠ¨ç”»æ—¶é—´è½´

### éšè—åŠ¨ç”»æ—¶é—´è½´ï¼ˆ200msï¼‰

```
æ—¶é—´    é¡¶éƒ¨å·¥å…·æ               ç« èŠ‚å¯¼èˆªå±‚              åº•éƒ¨å·¥å…·æ 
0ms     alpha=1.0, y=0         alpha=1.0, y=0         alpha=1.0, y=0
        â†“                      â†“                      â†“
50ms    alpha=0.75, y=-14px    alpha=0.75, y=+14px    alpha=0.75, y=+14px
        â†“                      â†“                      â†“
100ms   alpha=0.5, y=-28px     alpha=0.5, y=+28px     alpha=0.5, y=+28px
        â†“                      â†“                      â†“
150ms   alpha=0.25, y=-42px    alpha=0.25, y=+42px    alpha=0.25, y=+42px
        â†“                      â†“                      â†“
200ms   alpha=0.0, y=-56px     alpha=0.0, y=+56px     alpha=0.0, y=+56px
        visibility=GONE        visibility=GONE        visibility=GONE
```

### æ˜¾ç¤ºåŠ¨ç”»æ—¶é—´è½´ï¼ˆ200msï¼‰

```
æ—¶é—´    é¡¶éƒ¨å·¥å…·æ               ç« èŠ‚å¯¼èˆªå±‚              åº•éƒ¨å·¥å…·æ 
0ms     alpha=0.0, y=-56px     alpha=0.0, y=+56px     alpha=0.0, y=+56px
        visibility=VISIBLE     visibility=VISIBLE     visibility=VISIBLE
        â†“                      â†“                      â†“
50ms    alpha=0.25, y=-42px    alpha=0.25, y=+42px    alpha=0.25, y=+42px
        â†“                      â†“                      â†“
100ms   alpha=0.5, y=-28px     alpha=0.5, y=+28px     alpha=0.5, y=+28px
        â†“                      â†“                      â†“
150ms   alpha=0.75, y=-14px    alpha=0.75, y=+14px    alpha=0.75, y=+14px
        â†“                      â†“                      â†“
200ms   alpha=1.0, y=0         alpha=1.0, y=0         alpha=1.0, y=0
```

---

## ğŸ›¡ï¸ è¾¹ç•Œæƒ…å†µå¤„ç†

### 1. å¿«é€Ÿè¿ç»­æ»‘åŠ¨
```kotlin
// é˜²æŠ–åŠ¨æœºåˆ¶
if (kotlin.math.abs(scrollDelta) > scrollThreshold) {
    // åªå¤„ç†è¶…è¿‡é˜ˆå€¼çš„æ»‘åŠ¨
}

// é˜²æ­¢é‡å¤è§¦å‘
if (isAutoHiding) return
```

### 2. åŠ¨ç”»è¿›è¡Œä¸­å†æ¬¡æ»‘åŠ¨
```kotlin
// åœ¨ hideUIBars() å’Œ showUIBars() å¼€å§‹æ—¶æ£€æŸ¥
if (isAutoHiding) return  // å¦‚æœæ­£åœ¨åŠ¨ç”»ï¼Œç›´æ¥è¿”å›
```

### 3. å†…å®¹å¾ˆçŸ­çš„æƒ…å†µ
```kotlin
// æ»šåŠ¨åˆ°é¡¶éƒ¨å¼ºåˆ¶æ˜¾ç¤ºUI
if (currentScrollY <= 0 && !isMenuVisible) {
    showUIBars()
}
```

### 4. å°å¹…åº¦æŠ–åŠ¨
```kotlin
// é˜ˆå€¼è¿‡æ»¤
private val scrollThreshold = 10
if (kotlin.math.abs(scrollDelta) > scrollThreshold) {
    // åªæœ‰è¶…è¿‡10pxæ‰è§¦å‘
}
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. é¿å…é¢‘ç¹UIæ›´æ–°
- ä½¿ç”¨ `isAutoHiding` æ ‡å¿—é˜²æ­¢é‡å¤è§¦å‘
- è®¾ç½®æ»šåŠ¨é˜ˆå€¼é¿å…å°å¹…åº¦æ»‘åŠ¨è§¦å‘UIå˜åŒ–

### 2. åŠ¨ç”»æ€§èƒ½
- ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„ `View.animate()` API
- åŠ¨ç”»æ—¶é•¿è®¾ç½®ä¸º 200msï¼Œå¹³è¡¡æµç•…åº¦å’Œå“åº”é€Ÿåº¦

### 3. å†…å­˜ç®¡ç†
- ä½¿ç”¨ `?` å®‰å…¨è°ƒç”¨é¿å…ç©ºæŒ‡é’ˆ
- åŠ¨ç”»ç»“æŸååŠæ—¶é‡ç½®çŠ¶æ€æ ‡å¿—

---

## ğŸ” è°ƒè¯•å»ºè®®

### æ·»åŠ æ—¥å¿—
```kotlin
private fun setupScrollListener() {
    scrollView?.viewTreeObserver?.addOnScrollChangedListener {
        val view = scrollView ?: return@addOnScrollChangedListener
        val currentScrollY = view.scrollY
        
        Log.d("ReaderScroll", "currentScrollY: $currentScrollY, lastScrollY: $lastScrollY")
        
        val scrollDelta = currentScrollY - lastScrollY
        Log.d("ReaderScroll", "scrollDelta: $scrollDelta, threshold: $scrollThreshold")
        
        if (kotlin.math.abs(scrollDelta) > scrollThreshold) {
            when {
                scrollDelta > 0 -> {
                    Log.d("ReaderScroll", "å‘ä¸‹æ»‘åŠ¨ - éšè—UI")
                    if (isMenuVisible && !isAutoHiding) {
                        hideUIBars()
                    }
                }
                scrollDelta < 0 -> {
                    Log.d("ReaderScroll", "å‘ä¸Šæ»‘åŠ¨ - æ˜¾ç¤ºUI")
                    if (!isMenuVisible && !isAutoHiding) {
                        showUIBars()
                    }
                }
            }
        }
        
        lastScrollY = currentScrollY
    }
}
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒæœºåˆ¶
1. **æ»šåŠ¨ç›‘å¬**: é€šè¿‡ `ViewTreeObserver.OnScrollChangedListener` ç›‘å¬æ»šåŠ¨
2. **æ–¹å‘æ£€æµ‹**: é€šè¿‡ `scrollDelta` åˆ¤æ–­æ»‘åŠ¨æ–¹å‘
3. **é˜²æŠ–åŠ¨**: é€šè¿‡é˜ˆå€¼å’Œæ ‡å¿—ä½é¿å…é¢‘ç¹è§¦å‘
4. **æµç•…åŠ¨ç”»**: ä½¿ç”¨é€æ˜åº¦å’Œä½ç§»åŠ¨ç”»æä¾›æµç•…ä½“éªŒ

### ä¸‰å¤§åŠŸèƒ½
1. **è‡ªåŠ¨åŠ è½½**: è·ç¦»åº•éƒ¨ < 500px æ—¶åŠ è½½ä¸‹ä¸€ç« 
2. **æ™ºèƒ½éšè—**: å‘ä¸‹æ»‘åŠ¨æ—¶éšè—UIï¼Œæä¾›æ²‰æµ¸å¼ä½“éªŒ
3. **æ™ºèƒ½æ˜¾ç¤º**: å‘ä¸Šæ»‘åŠ¨æˆ–åˆ°è¾¾é¡¶éƒ¨æ—¶æ˜¾ç¤ºUIï¼Œæ–¹ä¾¿æ§åˆ¶

### è®¾è®¡ä¼˜åŠ¿
- âœ… å“åº”è¿…é€Ÿï¼šæ»šåŠ¨è¶…è¿‡10pxå³å¯è§¦å‘
- âœ… åŠ¨ç”»æµç•…ï¼š200msåŠ¨ç”»æ—¶é•¿ï¼Œè§†è§‰èˆ’é€‚
- âœ… é˜²æ­¢è¯¯è§¦ï¼šé˜ˆå€¼å’Œæ ‡å¿—ä½åŒé‡ä¿æŠ¤
- âœ… è¾¹ç•Œå¤„ç†ï¼šé¡¶éƒ¨å’Œåº•éƒ¨éƒ½æœ‰ç‰¹æ®Šé€»è¾‘
- âœ… åè°ƒä¸€è‡´ï¼šä¸‰å±‚UIç»Ÿä¸€çš„åŠ¨ç”»æ•ˆæœ
