# 复制文字自动展开功能测试指南

## 测试准备

### 1. 环境要求
- 灵动岛服务正常运行
- 剪贴板监听功能已启用
- 测试应用已安装（如浏览器、记事本等）

### 2. 测试状态
- **圆球状态**: 灵动岛最小化为圆球
- **紧凑状态**: 灵动岛显示为横条
- **搜索状态**: 灵动岛已展开搜索模式

## 测试用例

### 1. 基本功能测试

#### 测试用例 1.1: 正常文字复制
**测试步骤**:
1. 打开任意应用（如浏览器、记事本）
2. 选择一段文字（2-20个字符）
3. 复制文字（Ctrl+C 或长按选择复制）
4. 观察灵动岛行为

**预期结果**:
- 灵动岛自动展开（如果当前是圆球或紧凑状态）
- 复制的文字自动填入搜索框
- 显示Toast提示："检测到复制内容：xxx"
- 自动触发搜索，显示搜索结果

#### 测试用例 1.2: 长文本复制
**测试步骤**:
1. 复制一段较长的文字（50-100个字符）
2. 观察Toast提示内容

**预期结果**:
- 灵动岛正常展开
- Toast显示前20个字符+省略号
- 完整文字填入搜索框

#### 测试用例 1.3: 中文文字复制
**测试步骤**:
1. 复制中文文字（如"灵动岛功能测试"）
2. 观察搜索行为

**预期结果**:
- 正常检测和展开
- 中文文字正确填入搜索框
- 搜索功能正常工作

### 2. 状态测试

#### 测试用例 2.1: 圆球状态复制
**测试步骤**:
1. 将灵动岛最小化为圆球状态
2. 复制任意文字
3. 观察灵动岛行为

**预期结果**:
- 圆球先恢复为横条状态
- 然后展开搜索模式
- 复制的文字填入搜索框
- 整个过程流畅，无卡顿

#### 测试用例 2.2: 紧凑状态复制
**测试步骤**:
1. 确保灵动岛处于紧凑状态（横条）
2. 复制任意文字
3. 观察展开过程

**预期结果**:
- 直接展开搜索模式
- 复制的文字填入搜索框
- 展开动画流畅

#### 测试用例 2.3: 搜索状态复制
**测试步骤**:
1. 手动展开搜索模式
2. 复制任意文字
3. 观察搜索框变化

**预期结果**:
- 复制的文字替换当前搜索框内容
- 自动触发新的搜索
- 显示新的搜索结果

### 3. 内容过滤测试

#### 测试用例 3.1: 短文本过滤
**测试步骤**:
1. 复制1个字符的文本（如"a"）
2. 观察灵动岛行为

**预期结果**:
- 灵动岛不展开
- 不显示Toast提示
- 日志显示"内容太短，忽略"

#### 测试用例 3.2: 纯数字过滤
**测试步骤**:
1. 复制纯数字内容（如"123456"）
2. 观察灵动岛行为

**预期结果**:
- 灵动岛不展开
- 不显示Toast提示
- 日志显示"纯数字内容，忽略"

#### 测试用例 3.3: 纯符号过滤
**测试步骤**:
1. 复制纯符号内容（如"!@#$%"）
2. 观察灵动岛行为

**预期结果**:
- 灵动岛不展开
- 不显示Toast提示
- 日志显示"纯符号内容，忽略"

#### 测试用例 3.4: 超长文本过滤
**测试步骤**:
1. 复制超过500字符的文本
2. 观察灵动岛行为

**预期结果**:
- 灵动岛不展开
- 不显示Toast提示
- 日志显示"内容过长，忽略"

### 4. 防抖测试

#### 测试用例 4.1: 快速连续复制
**测试步骤**:
1. 快速连续复制不同的文字（间隔小于1秒）
2. 观察灵动岛行为

**预期结果**:
- 只有最后一次复制触发展开
- 前面的复制被防抖机制忽略
- 日志显示"剪贴板变化过于频繁，忽略此次变化"

#### 测试用例 4.2: 正常间隔复制
**测试步骤**:
1. 复制文字A
2. 等待2秒
3. 复制文字B
4. 观察两次复制的处理

**预期结果**:
- 两次复制都正常处理
- 灵动岛展开两次
- 搜索框内容更新为文字B

### 5. 功能开关测试

#### 测试用例 5.1: 禁用功能
**测试步骤**:
1. 调用 `setClipboardAutoExpandEnabled(false)`
2. 复制任意文字
3. 观察灵动岛行为

**预期结果**:
- 灵动岛不展开
- 不显示Toast提示
- 日志显示功能已禁用

#### 测试用例 5.2: 重新启用功能
**测试步骤**:
1. 调用 `setClipboardAutoExpandEnabled(true)`
2. 复制任意文字
3. 观察灵动岛行为

**预期结果**:
- 灵动岛正常展开
- 显示Toast提示
- 功能恢复正常

### 6. 异常情况测试

#### 测试用例 6.1: 剪贴板为空
**测试步骤**:
1. 清空剪贴板
2. 尝试复制空内容
3. 观察系统行为

**预期结果**:
- 灵动岛不展开
- 不显示Toast提示
- 系统正常运行

#### 测试用例 6.2: 剪贴板权限问题
**测试步骤**:
1. 在权限受限的环境中测试
2. 观察错误处理

**预期结果**:
- 记录错误日志
- 系统不崩溃
- 功能优雅降级

### 7. 性能测试

#### 测试用例 7.1: 大量复制测试
**测试步骤**:
1. 连续复制100次不同的文字
2. 观察系统性能

**预期结果**:
- 系统运行流畅
- 内存使用正常
- 无内存泄漏

#### 测试用例 7.2: 长时间运行测试
**测试步骤**:
1. 让系统运行24小时
2. 定期复制文字测试

**预期结果**:
- 功能持续正常
- 无内存泄漏
- 性能稳定

## 测试检查点

### 1. 功能检查
- [ ] 剪贴板监听器正常初始化
- [ ] 复制文字时灵动岛自动展开
- [ ] 复制的文字正确填入搜索框
- [ ] 自动触发搜索功能
- [ ] Toast提示正确显示

### 2. 状态检查
- [ ] 圆球状态下正确恢复并展开
- [ ] 紧凑状态下直接展开
- [ ] 搜索状态下正确更新内容

### 3. 过滤检查
- [ ] 短文本被正确过滤
- [ ] 纯数字内容被正确过滤
- [ ] 纯符号内容被正确过滤
- [ ] 超长文本被正确过滤

### 4. 防抖检查
- [ ] 快速连续复制被正确防抖
- [ ] 正常间隔复制正常工作
- [ ] 防抖时间设置合理

### 5. 性能检查
- [ ] 内存使用正常
- [ ] CPU使用率正常
- [ ] 无内存泄漏
- [ ] 响应时间合理

### 6. 异常检查
- [ ] 异常情况处理正确
- [ ] 错误日志记录完整
- [ ] 系统稳定性良好

## 测试工具

### 1. 日志查看
```bash
adb logcat | grep "DynamicIslandService"
```

### 2. 内存监控
```bash
adb shell dumpsys meminfo com.example.aifloatingball
```

### 3. 性能监控
```bash
adb shell top | grep "aifloatingball"
```

## 测试报告模板

### 测试环境
- 设备型号: 
- Android版本: 
- 应用版本: 
- 测试时间: 

### 测试结果
- 基本功能: ✅/❌
- 状态处理: ✅/❌
- 内容过滤: ✅/❌
- 防抖机制: ✅/❌
- 功能开关: ✅/❌
- 异常处理: ✅/❌
- 性能表现: ✅/❌

### 发现问题
1. 问题描述:
2. 重现步骤:
3. 预期结果:
4. 实际结果:
5. 严重程度:

### 测试结论
- 功能完整性: 
- 性能表现: 
- 稳定性: 
- 用户体验: 
- 建议改进:

## 注意事项

1. **测试环境**: 确保在真实设备上测试，模拟器可能无法完全模拟剪贴板行为
2. **权限检查**: 确保应用有剪贴板访问权限
3. **系统版本**: 不同Android版本的剪贴板API可能有差异
4. **性能监控**: 长时间测试时注意监控内存和CPU使用情况
5. **日志记录**: 测试过程中详细记录日志，便于问题定位

通过这个测试指南，可以全面验证复制文字自动展开功能的正确性和稳定性！

