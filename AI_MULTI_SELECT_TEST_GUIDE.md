# AI服务多选功能测试指南

## 🎯 功能概述

灵动岛AI助手现在支持多选AI服务功能，用户可以同时选择多个AI服务进行对比回答，实现更智能的AI助手体验。

## 🚀 新功能特性

### 1. 多选AI服务
- **CheckBox网格布局**：3列网格显示所有可用AI服务
- **多选支持**：可同时选择多个AI服务
- **状态持久化**：选择状态自动保存，重启应用后保持

### 2. 智能控制按钮
- **全选按钮**：一键选择所有AI服务
- **清空按钮**：一键清空所有选择
- **状态显示**：实时显示当前选择状态

### 3. 并发AI调用
- **同步调用**：所有选中的AI服务同时响应
- **独立卡片**：每个AI服务显示独立回复卡片
- **流式更新**：实时显示AI回复进度

## 📱 测试步骤

### 步骤1：启动应用并进入灵动岛模式
1. 启动应用
2. 点击灵动岛最左边的AI按钮
3. 观察AI助手面板是否正常显示

### 步骤2：测试多选界面
1. **检查CheckBox布局**
   - 确认AI服务以3列网格形式显示
   - 验证所有9个AI服务都显示：DeepSeek、智谱AI、Kimi、ChatGPT、Claude、Gemini、文心一言、通义千问、讯飞星火

2. **测试多选功能**
   - 点击任意AI服务的CheckBox
   - 确认选中状态正确显示
   - 尝试选择多个AI服务
   - 验证状态显示文本更新

3. **测试控制按钮**
   - 点击"全选"按钮
   - 确认所有AI服务都被选中
   - 点击"清空"按钮
   - 确认所有选择被清空

### 步骤3：测试AI回复功能
1. **输入测试问题**
   - 在输入框中输入测试问题，如："请介绍一下人工智能的发展历史"
   - 选择2-3个AI服务
   - 点击发送按钮

2. **观察并发调用**
   - 确认所有选中的AI服务同时开始响应
   - 观察每个AI服务的独立回复卡片
   - 验证流式响应实时更新

3. **测试横向滚动**
   - 左右滑动查看不同AI的回复
   - 确认卡片布局和内容显示正常

### 步骤4：测试切换AI功能
1. **测试切换按钮**
   - 点击"切换AI"按钮
   - 验证AI服务选择的变化
   - 确认状态显示正确更新

2. **测试不同选择状态**
   - 无选择时点击切换：应选择第一个AI
   - 单选时点击切换：应切换到下一个AI
   - 多选时点击切换：应清空多选，选择第一个AI

### 步骤5：测试状态持久化
1. **保存选择状态**
   - 选择特定的AI服务组合
   - 关闭AI助手面板
   - 重新打开AI助手面板
   - 确认选择状态被保持

2. **重启应用测试**
   - 重启应用
   - 进入AI助手面板
   - 确认之前的选择状态被恢复

## 🔍 预期结果

### 界面表现
- ✅ AI服务以3列网格整齐排列
- ✅ CheckBox样式统一，选中状态清晰
- ✅ 状态显示文本实时更新
- ✅ 控制按钮响应正常

### 功能表现
- ✅ 多选功能正常工作
- ✅ 全选/清空按钮生效
- ✅ 并发AI调用正常
- ✅ 流式响应实时更新
- ✅ 横向滚动查看正常
- ✅ 状态持久化正常

### 性能表现
- ✅ 界面响应流畅
- ✅ AI调用并发执行
- ✅ 内存使用合理
- ✅ 无卡顿现象

## 🐛 常见问题排查

### 问题1：CheckBox不显示
**可能原因**：布局文件问题
**解决方法**：检查`ai_assistant_panel.xml`中的`ai_services_checkbox_container`

### 问题2：多选不生效
**可能原因**：AIServiceSelectionManager未正确初始化
**解决方法**：检查`DynamicIslandService.kt`中的初始化代码

### 问题3：AI调用失败
**可能原因**：API密钥配置问题
**解决方法**：检查AI服务配置和API密钥

### 问题4：状态不持久化
**可能原因**：SharedPreferences保存失败
**解决方法**：检查AIServiceSelectionManager的保存逻辑

## 📊 测试数据记录

### 测试环境
- 设备型号：_______
- Android版本：_______
- 应用版本：_______
- 测试时间：_______

### 测试结果
- [ ] 界面显示正常
- [ ] 多选功能正常
- [ ] 控制按钮正常
- [ ] AI调用正常
- [ ] 流式响应正常
- [ ] 状态持久化正常
- [ ] 性能表现良好

### 发现问题
1. 问题描述：_______
   解决方案：_______

2. 问题描述：_______
   解决方案：_______

## 🎉 测试完成确认

当所有测试项目都通过后，AI服务多选功能即可正式投入使用。用户现在可以：

1. **灵活选择**：根据需要选择单个或多个AI服务
2. **对比分析**：同时获得多个AI的不同观点
3. **高效使用**：一键全选或清空，操作便捷
4. **状态保持**：选择偏好自动保存，无需重复设置

这个功能将大大提升AI助手的使用体验和实用性！
