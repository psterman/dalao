# 软件tab AI应用直接提问功能测试指南

## 功能概述

根据用户需求，软件tab的AI分类现在支持两种方案：
1. **支持Intent的AI应用**：当用户在软件tab的输入框输入文字后，进入app后直接发送文字
2. **不支持Intent的AI应用**：在跳转后的AI app的输入框中粘贴已输入的文字，等待用户自行点击发送

## 支持的AI应用

### 1. DeepSeek
- **包名**: `com.deepseek.chat`
- **方案**: 优先尝试Intent发送，失败则使用剪贴板方案

### 2. 豆包
- **包名**: `com.larus.nova`
- **方案**: 优先尝试Intent发送，失败则使用剪贴板方案

### 3. ChatGPT
- **包名**: `com.openai.chatgpt`
- **方案**: 优先尝试Intent发送，失败则使用剪贴板方案

### 4. Kimi
- **包名**: `com.moonshot.kimichat`
- **方案**: 优先尝试Intent发送，失败则使用剪贴板方案

### 5. 腾讯元宝
- **包名**: `com.tencent.hunyuan.app.chat`
- **方案**: 优先尝试Intent发送，失败则使用剪贴板方案

## 技术实现

### 1. AI应用识别
```kotlin
private fun isAIApp(appConfig: AppSearchConfig): Boolean {
    return appConfig.category == AppCategory.AI || 
           appConfig.appId in listOf("deepseek", "doubao", "chatgpt", "kimi", "tencent_yuanbao")
}
```

### 2. 双方案实现
- **方案1 (Intent发送)**: 使用`Intent.ACTION_SEND`直接发送文本到AI应用
- **方案2 (剪贴板传递)**: 将文本复制到剪贴板，启动AI应用，提示用户粘贴

### 3. 错误处理
- 完善的异常捕获和用户提示
- 自动降级到剪贴板方案
- 详细的日志记录

## 测试步骤

### 1. 基础功能测试

#### 1.1 输入文字并点击AI应用
1. 打开软件tab
2. 切换到AI分类
3. 在输入框中输入问题（如："你好，请介绍一下自己"）
4. 点击任意AI应用图标
5. 验证AI应用是否启动并接收到问题

#### 1.2 测试不同AI应用
对每个AI应用重复上述步骤：
- DeepSeek
- 豆包
- ChatGPT
- Kimi
- 腾讯元宝

### 2. Intent发送方案测试

#### 2.1 成功场景
1. 确保AI应用已安装
2. 输入问题并点击AI应用
3. 验证是否显示"正在向[AI名称]发送问题..."提示
4. 验证AI应用是否直接接收到问题（无需手动粘贴）

#### 2.2 失败场景
1. 如果Intent发送失败
2. 验证是否自动降级到剪贴板方案
3. 验证是否显示"已复制问题到剪贴板，请粘贴到[AI名称]的输入框中"提示

### 3. 剪贴板方案测试

#### 3.1 剪贴板复制测试
1. 输入问题并点击AI应用
2. 验证问题是否被复制到剪贴板
3. 在AI应用中长按输入框
4. 验证是否出现"粘贴"选项
5. 点击粘贴，验证问题是否正确显示

#### 3.2 应用启动测试
1. 验证AI应用是否正确启动
2. 验证是否显示正确的提示信息
3. 验证用户能否正常使用AI应用

### 4. 错误处理测试

#### 4.1 应用未安装测试
1. 卸载某个AI应用
2. 尝试点击该AI应用
3. 验证是否显示"应用未安装或无法启动"提示

#### 4.2 权限不足测试
1. 如果出现权限问题
2. 验证是否显示"权限不足，请检查应用权限"提示

#### 4.3 其他错误测试
1. 验证是否显示"发送失败，请手动打开[AI名称]"提示
2. 验证错误日志是否正确记录

### 5. 用户体验测试

#### 5.1 操作流畅性
1. 验证点击响应是否及时
2. 验证提示信息是否清晰
3. 验证操作流程是否顺畅

#### 5.2 提示信息测试
1. 验证Toast提示是否准确
2. 验证提示时长是否合适
3. 验证提示内容是否易懂

#### 5.3 搜索历史测试
1. 验证AI提问是否保存到搜索历史
2. 验证搜索历史是否正确显示

## 测试用例

### 测试用例1：DeepSeek Intent发送成功
**操作**：输入"你好"并点击DeepSeek
**预期**：显示"正在向DeepSeek发送问题..."，DeepSeek直接接收问题

### 测试用例2：豆包剪贴板方案
**操作**：输入"介绍一下自己"并点击豆包
**预期**：显示"已复制问题到剪贴板，请粘贴到豆包的输入框中"，豆包启动

### 测试用例3：ChatGPT应用未安装
**操作**：卸载ChatGPT后点击
**预期**：显示"应用未安装或无法启动"

### 测试用例4：Kimi权限问题
**操作**：在权限受限情况下点击Kimi
**预期**：显示"权限不足，请检查应用权限"

### 测试用例5：腾讯元宝通用方案
**操作**：输入长文本并点击腾讯元宝
**预期**：优先尝试Intent，失败则使用剪贴板方案

## 验证要点

### 1. 功能正确性
- [ ] AI应用识别正确
- [ ] Intent发送方案工作正常
- [ ] 剪贴板方案工作正常
- [ ] 错误处理完善

### 2. 用户体验
- [ ] 操作响应及时
- [ ] 提示信息清晰
- [ ] 流程顺畅自然
- [ ] 错误提示友好

### 3. 兼容性
- [ ] 支持所有配置的AI应用
- [ ] 处理各种异常情况
- [ ] 适配不同Android版本

### 4. 性能表现
- [ ] 启动速度正常
- [ ] 内存使用合理
- [ ] 无卡顿现象

## 日志监控

在测试过程中，注意观察以下日志：
- `处理AI应用直接提问: [AI名称], 问题: [问题内容]`
- `[AI名称] Intent发送成功`
- `剪贴板传递成功: [AI名称]`
- `AI应用操作失败: [AI名称]`

## 预期效果

### 1. 方案1 (Intent发送)
- **用户体验**：无缝体验，问题直接发送到AI应用
- **技术实现**：使用`Intent.ACTION_SEND`直接传递文本
- **适用场景**：支持Intent的AI应用

### 2. 方案2 (剪贴板传递)
- **用户体验**：需要手动粘贴，但问题已准备好
- **技术实现**：复制到剪贴板，启动应用，提示粘贴
- **适用场景**：不支持Intent的AI应用或Intent失败时

### 3. 智能降级
- **自动检测**：优先尝试Intent方案
- **自动降级**：Intent失败时自动使用剪贴板方案
- **用户提示**：清晰说明当前使用的方案

通过这些优化，软件tab的AI分类现在支持智能的直接提问功能，大大提升了用户体验，让用户能够快速向AI应用发送问题，无需重新输入。

