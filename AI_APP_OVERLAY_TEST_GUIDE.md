# AI应用悬浮窗功能测试指南

## 功能概述

新增了AI应用悬浮窗功能，当用户从软件tab跳转到AI应用后，会在AI应用上方显示一个悬浮窗，包含：
- **返回按钮** - 直接返回主应用
- **粘贴按钮** - 将文本复制到剪贴板并尝试自动粘贴
- **关闭按钮** - 关闭悬浮窗

## 技术实现

### 1. 悬浮窗服务
- **服务类**: `AIAppOverlayService`
- **权限**: `SYSTEM_ALERT_WINDOW` (悬浮窗权限)
- **窗口类型**: `TYPE_APPLICATION_OVERLAY` (Android 8.0+)

### 2. 悬浮窗UI
- **布局文件**: `ai_app_overlay.xml`
- **背景样式**: `ai_overlay_background.xml`
- **按钮样式**: `ai_overlay_button_background.xml`
- **特性**: 可拖拽、半透明背景

### 3. 功能特性
- **自动显示**: AI应用启动后2秒自动显示
- **智能粘贴**: 支持剪贴板复制和自动粘贴
- **拖拽支持**: 用户可以拖拽悬浮窗到任意位置
- **自动隐藏**: 点击返回或关闭按钮后自动隐藏

## 测试步骤

### 1. 基础功能测试

#### 1.1 测试DeepSeek悬浮窗
1. 打开软件tab
2. 切换到AI分类
3. 在输入框中输入问题（如："你好，请介绍一下自己"）
4. 点击DeepSeek图标
5. 验证DeepSeek是否启动
6. 等待2秒，验证悬浮窗是否出现
7. 验证悬浮窗显示"DeepSeek"应用名称

#### 1.2 测试智谱清言悬浮窗
1. 在输入框中输入问题（如："请解释一下人工智能的发展历程"）
2. 点击智谱清言图标
3. 验证智谱清言是否启动
4. 等待2秒，验证悬浮窗是否出现
5. 验证悬浮窗显示"智谱清言"应用名称

#### 1.3 测试其他AI应用悬浮窗
对以下AI应用重复上述步骤：
- Manus
- 纳米AI
- Poe
- Grok

### 2. 悬浮窗功能测试

#### 2.1 返回按钮测试
1. 启动任意AI应用并显示悬浮窗
2. 点击悬浮窗中的"返回"按钮
3. 验证是否返回到主应用
4. 验证悬浮窗是否自动隐藏

#### 2.2 粘贴按钮测试
1. 启动任意AI应用并显示悬浮窗
2. 点击悬浮窗中的"粘贴"按钮
3. 验证是否显示"文本已复制到剪贴板"提示
4. 验证剪贴板中是否包含输入的问题文本
5. 在AI应用中长按输入框，验证是否可以粘贴

#### 2.3 关闭按钮测试
1. 启动任意AI应用并显示悬浮窗
2. 点击悬浮窗中的"关闭"按钮
3. 验证悬浮窗是否隐藏
4. 验证AI应用是否继续运行

#### 2.4 拖拽功能测试
1. 启动任意AI应用并显示悬浮窗
2. 长按悬浮窗并拖拽到屏幕其他位置
3. 验证悬浮窗是否跟随手指移动
4. 松开手指，验证悬浮窗是否停留在新位置

### 3. 边界情况测试

#### 3.1 权限测试
1. 如果悬浮窗权限未授予，验证是否有权限请求
2. 拒绝权限后，验证是否回退到自动粘贴方案
3. 授予权限后，验证悬浮窗是否正常显示

#### 3.2 应用未安装测试
1. 卸载某个AI应用
2. 尝试点击该应用图标
3. 验证是否显示安装提示
4. 验证悬浮窗不会显示

#### 3.3 网络问题测试
1. 断开网络连接
2. 尝试启动AI应用
3. 验证应用是否能够正常启动
4. 验证悬浮窗是否正常显示

### 4. 用户体验测试

#### 4.1 悬浮窗位置测试
1. 验证悬浮窗默认位置（右上角）
2. 拖拽到不同位置后重启应用
3. 验证悬浮窗是否记住位置

#### 4.2 悬浮窗大小测试
1. 验证悬浮窗大小是否合适
2. 验证按钮是否易于点击
3. 验证文字是否清晰可读

#### 4.3 多应用切换测试
1. 启动AI应用A，显示悬浮窗
2. 切换到其他应用
3. 返回AI应用A，验证悬浮窗是否仍然显示
4. 启动AI应用B，验证悬浮窗是否更新

## 预期结果

### 成功情况
- AI应用能够正常启动
- 悬浮窗在2秒后自动显示
- 悬浮窗显示正确的应用名称
- 返回按钮能够正确返回主应用
- 粘贴按钮能够复制文本到剪贴板
- 关闭按钮能够隐藏悬浮窗
- 悬浮窗支持拖拽移动

### 失败情况处理
- 如果悬浮窗权限未授予，自动回退到自动粘贴方案
- 如果悬浮窗显示失败，自动回退到自动粘贴方案
- 如果AI应用启动失败，显示相应的错误提示

## 日志监控

在测试过程中，可以通过以下日志标签监控功能状态：

- `AIAppOverlayService` - 悬浮窗服务日志
- `SimpleModeActivity` - 主应用日志
- `MyAccessibilityService` - 无障碍服务日志（自动粘贴）

## 注意事项

1. 确保悬浮窗权限已授予
2. 确保目标AI应用已安装
3. 测试时注意观察悬浮窗的显示和隐藏
4. 如果遇到问题，可以尝试重启应用或重新授予权限

## 故障排除

### 常见问题
1. **悬浮窗不显示** - 检查悬浮窗权限是否授予
2. **悬浮窗无法拖拽** - 检查触摸事件处理
3. **粘贴按钮不工作** - 检查剪贴板权限
4. **返回按钮不工作** - 检查Intent启动逻辑

### 解决方案
1. 重新授予悬浮窗权限
2. 重启应用
3. 检查权限设置
4. 查看日志输出排查问题

## 优化建议

1. 添加悬浮窗透明度调节
2. 添加悬浮窗大小调节
3. 添加悬浮窗位置记忆功能
4. 添加更多快捷操作按钮
5. 添加悬浮窗动画效果
