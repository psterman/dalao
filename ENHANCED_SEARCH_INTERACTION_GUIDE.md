# 增强搜索交互功能指南

## 功能概述

灵动岛搜索面板现已支持更智能的交互逻辑，根据不同的选择方式提供不同的用户体验。

## 新增功能

### 1. 搜索结果应用选择优化
**场景**: 用户在搜索框中输入文本过滤应用后，点击搜索结果中的应用图标

**行为**:
- ✅ 清理输入框中的所有文本
- ✅ 设置提示信息："已选中 [应用名]，请输入搜索内容"
- ✅ 不退出搜索面板，等待用户输入新的搜索关键词
- ✅ 用户输入新关键词后，点击搜索按钮执行搜索

### 2. 历史列表应用选择优化
**场景**: 用户点击左侧历史应用列表中的应用

**行为**:
- **搜索框不为空**: 直接使用搜索框中的内容执行搜索，然后退出搜索面板
- **搜索框为空**: 只选中应用，设置提示信息，等待用户输入搜索关键词

## 技术实现

### 1. 搜索结果应用选择逻辑

```kotlin
private fun selectAppForSearch(appInfo: AppInfo) {
    // 添加到最近选中的APP列表
    addToRecentApps(appInfo)
    // 更新最近APP按钮图标
    updateRecentAppButton(appInfo)
    // 设置当前选中的APP
    currentSelectedApp = appInfo
    
    // 清理输入框文本，等待用户输入新的搜索关键词
    searchInput?.setText("")
    searchInput?.hint = "已选中 ${appInfo.label}，请输入搜索内容"
    
    // 显示选中提示
    Toast.makeText(this, "已选中 ${appInfo.label}，请输入搜索内容", Toast.LENGTH_SHORT).show()
}
```

### 2. 历史列表应用选择逻辑

```kotlin
onAppClick = { appInfo ->
    // 检查搜索框是否有内容
    val searchText = searchInput?.text.toString().trim()
    if (searchText.isNotEmpty()) {
        // 搜索框不为空，直接执行搜索
        handleSearchWithSelectedApp(searchText, appInfo)
        currentSelectedApp = null
        hideRecentAppsDropdown()
    } else {
        // 搜索框为空，只选中应用，等待用户输入
        selectAppFromHistory(appInfo)
        hideRecentAppsDropdown()
    }
}
```

### 3. 历史列表选中应用处理

```kotlin
private fun selectAppFromHistory(appInfo: AppInfo) {
    // 添加到最近选中的APP列表
    addToRecentApps(appInfo)
    // 更新最近APP按钮图标
    updateRecentAppButton(appInfo)
    // 设置当前选中的APP
    currentSelectedApp = appInfo
    
    // 设置提示信息，等待用户输入搜索关键词
    searchInput?.hint = "已选中 ${appInfo.label}，请输入搜索内容"
    
    // 显示选中提示
    Toast.makeText(this, "已选中 ${appInfo.label}，请输入搜索内容", Toast.LENGTH_SHORT).show()
}
```

## 交互流程示例

### 场景1: 搜索结果应用选择

```
步骤1: 用户在搜索框输入"微"
结果: 显示微信、微博等应用图标

步骤2: 用户点击微信图标
结果: 
- 输入框文本被清空
- 提示信息："已选中 微信，请输入搜索内容"
- 搜索面板保持打开状态

步骤3: 用户输入"天气"
结果: 输入框显示"天气"

步骤4: 用户点击搜索按钮
结果: 跳转到微信搜索"天气"，搜索面板退出
```

### 场景2: 历史列表应用选择（搜索框不为空）

```
步骤1: 用户在搜索框输入"音乐"
结果: 搜索框显示"音乐"

步骤2: 用户点击历史列表中的QQ图标
结果: 
- 直接使用"音乐"作为搜索关键词
- 跳转到QQ搜索"音乐"
- 搜索面板退出
```

### 场景3: 历史列表应用选择（搜索框为空）

```
步骤1: 搜索框为空

步骤2: 用户点击历史列表中的微信图标
结果: 
- 提示信息："已选中 微信，请输入搜索内容"
- 搜索面板保持打开状态

步骤3: 用户输入"天气"
结果: 输入框显示"天气"

步骤4: 用户点击搜索按钮
结果: 跳转到微信搜索"天气"，搜索面板退出
```

## 用户体验改进

### 1. 更直观的操作反馈
- **搜索结果选择**: 清理输入框，明确提示用户需要输入新内容
- **历史列表选择**: 根据搜索框状态智能决定是否直接执行搜索

### 2. 更灵活的使用方式
- **快速搜索**: 历史列表选择 + 搜索框有内容 = 立即执行搜索
- **精确搜索**: 历史列表选择 + 搜索框为空 = 等待用户输入具体内容

### 3. 更清晰的状态提示
- 选中应用后显示明确的提示信息
- 用户清楚知道当前的操作状态和下一步需要做什么

## 测试用例

### 测试用例1: 搜索结果应用选择
```
前置条件: 搜索框有内容"微"，显示微信、微博等应用
操作: 点击微信图标
预期结果: 
- 输入框被清空
- 提示："已选中 微信，请输入搜索内容"
- 搜索面板保持打开
- 可以继续输入新内容
```

### 测试用例2: 历史列表选择（有内容）
```
前置条件: 搜索框有内容"音乐"
操作: 点击历史列表中的QQ图标
预期结果: 
- 直接跳转到QQ搜索"音乐"
- 搜索面板退出
```

### 测试用例3: 历史列表选择（无内容）
```
前置条件: 搜索框为空
操作: 点击历史列表中的微信图标
预期结果: 
- 提示："已选中 微信，请输入搜索内容"
- 搜索面板保持打开
- 可以继续输入内容
```

### 测试用例4: 混合操作
```
步骤1: 输入"微"，点击微信图标
步骤2: 输入"天气"，点击搜索按钮
预期结果: 跳转到微信搜索"天气"

步骤3: 输入"音乐"，点击历史列表中的QQ图标
预期结果: 跳转到QQ搜索"音乐"
```

## 调试信息

### 关键日志
```bash
adb logcat | grep "DynamicIslandService"
```

**搜索结果选择**:
- `选中应用: [应用名]`

**历史列表选择**:
- `历史列表选择应用，直接执行搜索: [应用名], 搜索内容: [内容]`
- `历史列表选择应用，等待用户输入: [应用名]`
- `从历史列表选中应用: [应用名]`

## 总结

新的交互逻辑提供了更智能、更灵活的用户体验：

- ✅ **搜索结果选择**: 清理输入框，等待用户输入新内容
- ✅ **历史列表选择**: 根据搜索框状态智能决定是否直接执行搜索
- ✅ **状态提示**: 清晰的视觉反馈和操作提示
- ✅ **操作流畅**: 减少不必要的步骤，提高操作效率

这种设计让用户可以根据不同的使用场景选择最合适的操作方式，既支持快速搜索，也支持精确搜索。
