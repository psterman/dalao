# DeepSeek风格AI回复格式化测试指南

## 优化概述

参考DeepSeek的回复格式，全面增强了AI回复文本的排版功能，实现了以下改进：

1. **增强的标题格式化**：支持多级标题和常见小标题格式
2. **改进的列表格式化**：支持中文数字列表和特殊符号
3. **丰富的强调格式**：支持书名号、引号等特殊强调
4. **智能断行处理**：根据内容结构自动添加适当换行
5. **DeepSeek风格特殊格式**：识别并格式化常见的AI回复模式

## 技术实现

### 1. 增强的标题格式化
```kotlin
// 处理多级标题
formatted = formatted.replace("^#{1}\\s+(.*)$".toRegex(), "\n■ $1\n")
formatted = formatted.replace("^#{2}\\s+(.*)$".toRegex(), "\n▪ $1\n")

// 处理常见的小标题格式（参考DeepSeek）
formatted = formatted.replace("^([一二三四五六七八九十]+[、.])\\s*(.*)$".toRegex(), "\n▪ $1 $2\n")
formatted = formatted.replace("^([0-9]+[、.])\\s*(.*)$".toRegex(), "\n▪ $1 $2\n")

// 处理带冒号的小标题
formatted = formatted.replace("^([^：:]+[：:])\\s*$".toRegex(), "\n▪ $1\n")
```

### 2. 改进的列表格式化
```kotlin
// 处理有序列表
formatted = formatted.replace("^\\s*(\\d+)\\.\\s+(.*)$".toRegex(), "  $1. $2")

// 处理中文数字列表
formatted = formatted.replace("^\\s*([一二三四五六七八九十]+)\\.\\s+(.*)$".toRegex(), "  $1. $2")

// 处理嵌套列表
formatted = formatted.replace("^\\s{2,4}[-*+]\\s+(.*)$".toRegex(), "    ◦ $1")
```

### 3. 丰富的强调格式
```kotlin
// 处理粗体
formatted = formatted.replace("\\*\\*(.*?)\\*\\*".toRegex(), "【$1】")

// 处理书名号《》
formatted = formatted.replace("《([^》]+)》".toRegex(), "【$1】")

// 处理引号
formatted = formatted.replace("\"([^\"]+)\"".toRegex(), "「$1」")
```

### 4. 智能断行处理
```kotlin
// 在句号、问号、感叹号后添加换行
formatted = formatted.replace("([。！？])\\s*([A-Z0-9一-龯])".toRegex(), "$1\n\n$2")

// 在逗号后添加换行（参考DeepSeek）
formatted = formatted.replace("([，,])\\s*([一-龯A-Z])".toRegex(), "$1\n$2")

// 处理列表项之间的换行
formatted = formatted.replace("(\\d+\\.\\s+[^\\n]+)\\n(\\d+\\.\\s+)".toRegex(), "$1\n\n$2")
```

### 5. DeepSeek风格特殊格式
```kotlin
// 处理"好的"开头
formatted = formatted.replace("^好的[，,]?\\s*(.*)$".toRegex(), "\n💡 $1\n")

// 处理"核心"、"主要"等关键词
formatted = formatted.replace("^核心\\s*(.*)$".toRegex(), "\n⭐ 核心$1\n")
formatted = formatted.replace("^主要\\s*(.*)$".toRegex(), "\n🔸 主要$1\n")

// 处理"特点"、"特色"等
formatted = formatted.replace("^特点[:：]\\s*(.*)$".toRegex(), "\n✨ 特点：$1\n")
```

## 测试步骤

### 测试1：标题格式化
1. 向AI发送包含标题的消息，如：
   ```
   请介绍以下内容：
   # 主要概念
   ## 详细说明
   一、基本概念
   二、应用场景
   ```
2. **预期结果**：
   - `# 主要概念` → `■ 主要概念`
   - `## 详细说明` → `▪ 详细说明`
   - `一、基本概念` → `▪ 一、 基本概念`
   - `二、应用场景` → `▪ 二、 应用场景`

### 测试2：列表格式化
1. 向AI发送包含列表的消息，如：
   ```
   请列出以下内容：
   1. 第一项
   2. 第二项
   - 子项目1
   - 子项目2
   ```
2. **预期结果**：
   - 有序列表保持数字序号，有适当缩进
   - 无序列表使用 `•` 符号
   - 嵌套列表有层级缩进

### 测试3：强调格式化
1. 向AI发送包含强调的消息，如：
   ```
   请解释以下概念：
   **重要概念** 和 "引用内容"
   《书名》中的内容
   ```
2. **预期结果**：
   - `**重要概念**` → `【重要概念】`
   - `"引用内容"` → `「引用内容」`
   - `《书名》` → `【书名】`

### 测试4：DeepSeek风格格式
1. 向AI发送包含特殊格式的消息，如：
   ```
   好的，这里有一份详细介绍
   核心亮点与城市名片
   主要特点：
   1. 地理位置
   2. 经济发展
   ```
2. **预期结果**：
   - `好的，这里有一份详细介绍` → `💡 这里有一份详细介绍`
   - `核心亮点与城市名片` → `⭐ 核心亮点与城市名片`
   - `主要特点：` → `🔸 主要特点：`

### 测试5：智能断行
1. 向AI发送长文本消息
2. **预期结果**：
   - 句号、问号、感叹号后自动换行
   - 逗号后适当换行
   - 列表项之间有适当间距
   - 段落之间有合理间距

### 测试6：群聊模式格式化
1. 在群聊中向AI发送包含各种格式的消息
2. **预期结果**：
   - 群聊中的AI回复也应用相同的格式化
   - 多个AI的回复都正确格式化
   - 格式化不影响群聊的其他功能

## 格式化效果对比

### 优化前
```
好的，这里有一份关于衡阳的详细介绍。衡阳是湖南省南部的重要城市，是湘南地区的经济、文化、交通中心。一、地理位置：位于南岳衡山以南，因此得名。二、经济发展：以工业为主，农业发达，特别是水稻种植和水产养殖。三、旅游资源：旅游资源丰富，最著名的是南岳衡山，是道教和佛教的圣地，也是中国五岳之一。
```

### 优化后
```
💡 这里有一份关于衡阳的详细介绍

衡阳是湖南省南部的重要城市，是湘南地区的经济、文化、交通中心

▪ 一、 地理位置：
位于南岳衡山以南，因此得名

▪ 二、 经济发展：
以工业为主，农业发达，特别是水稻种植和水产养殖

▪ 三、 旅游资源：
旅游资源丰富，最著名的是【南岳衡山】，是道教和佛教的圣地，也是中国五岳之一
```

## 特殊格式说明

### 1. 标题层级
- `■` 一级标题（最重要）
- `▪` 二级标题（重要）
- `▫` 三级标题（一般）

### 2. 列表符号
- `•` 主要列表项
- `◦` 二级列表项
- `▪` 三级列表项

### 3. 特殊标识
- `💡` 提示/介绍
- `📖` 详细说明
- `⭐` 核心内容
- `🔸` 主要内容
- `✨` 特点/特色
- `🚀` 优势/优点
- `❓` 问题
- `📋` 步骤
- `🔹` 要点
- `⚠️` 注意
- `📝` 总结

### 4. 强调格式
- `【】` 粗体/书名
- `「」` 引用/代码
- `~~` 删除线

## 验证要点

### 1. 格式正确性
- [ ] 标题格式正确显示
- [ ] 列表格式层次清晰
- [ ] 强调格式正确应用
- [ ] 特殊格式正确识别

### 2. 可读性提升
- [ ] 文本分段合理
- [ ] 换行位置恰当
- [ ] 缩进层次清晰
- [ ] 没有格式混乱

### 3. DeepSeek风格
- [ ] 识别"好的"开头
- [ ] 识别"核心"、"主要"等关键词
- [ ] 识别"特点"、"特色"等描述
- [ ] 识别"优势"、"优点"等评价

### 4. 兼容性
- [ ] 单聊模式格式化正常
- [ ] 群聊模式格式化正常
- [ ] 不同AI的回复都格式化
- [ ] 不影响其他功能

## 测试完成标准

- [ ] 所有格式类型正确显示
- [ ] 文本排版整齐有序
- [ ] 分类清晰易读
- [ ] DeepSeek风格正确应用
- [ ] 单聊和群聊模式都正常
- [ ] 性能表现良好
- [ ] 用户体验提升明显

## 注意事项

1. **向后兼容**：格式化不影响现有功能
2. **性能优化**：格式化处理高效快速
3. **可读性优先**：确保文本易于阅读
4. **一致性**：所有AI回复使用统一格式
5. **DeepSeek风格**：参考DeepSeek的回复格式特点
