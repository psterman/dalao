# 简易模式AI按钮添加测试指南

## 功能概述
在简易模式搜索tab的最上方输入框中添加了AI按钮，用户点击后可以：
1. 弹出AI助手档案菜单
2. 选择档案后，将相关用户选择的预设资料粘贴到当前输入框内
3. 支持预设资料预览功能
4. 智能处理输入框已有内容的情况

## 修改内容

### 1. 布局文件修改
- **文件**: `app/src/main/res/layout/activity_simple_mode.xml`
- **修改**: 在清空按钮后添加了AI助手按钮
- **位置**: 第2086-2095行

### 2. 代码文件修改
- **文件**: `app/src/main/java/com/example/aifloatingball/SimpleModeActivity.kt`
- **修改内容**:
  - 添加了`browserBtnAi`变量声明（第300行）
  - 添加了`browserBtnAi`的初始化代码（第1360行）
  - 添加了AI按钮的点击事件处理（第4799-4802行）
  - 添加了`showBrowserTabAIProfileSelector`方法（第19541-19650行）
  - 添加了`showBrowserPromptInsertionDialog`方法（第19652-19707行）

## 测试步骤

### 1. 基础功能测试
1. **启动应用**，进入简易模式
2. **切换到搜索tab**（第二个tab）
3. **查看最上方输入框**，确认：
   - 输入框显示"搜索或输入网址"
   - 输入框右边有清空按钮和AI按钮
   - AI按钮显示为AI助手图标

### 2. AI按钮功能测试
1. **点击AI按钮**
2. **验证**弹出AI助手档案选择器对话框
3. **验证**对话框显示所有可用的AI助手档案
4. **验证**预设资料预览区域正常显示

### 3. 档案选择测试
1. **在档案选择器中**，点击不同的档案
2. **验证预览区域**实时更新显示对应档案的预设资料
3. **选择档案并点击确认**
4. **验证**预设资料正确插入到输入框

### 4. 智能粘贴功能测试

#### 4.1 输入框为空的情况
1. **确保搜索输入框为空**
2. **选择档案并确认**
3. **验证**预设资料直接插入到输入框
4. **验证**光标位置在文本末尾

#### 4.2 输入框有内容的情况
1. **在搜索输入框中输入一些文字**（如"测试内容"）
2. **选择档案并确认**
3. **验证**弹出插入选项对话框，包含以下选项：
   - 替换现有内容
   - 追加到现有内容
   - 插入到开头
   - 取消

#### 4.3 测试各种插入选项
1. **选择"替换现有内容"**，验证输入框内容被完全替换
2. **选择"追加到现有内容"**，验证预设资料追加到现有内容后面
3. **选择"插入到开头"**，验证预设资料插入到现有内容前面
4. **选择"取消"**，验证输入框内容保持不变

### 5. 用户体验测试
1. **测试档案切换**，验证切换后预设资料正确更新
2. **测试取消操作**，验证取消后不会影响输入框内容
3. **测试错误处理**，验证当档案配置有问题时显示适当提示
4. **测试界面响应**，验证所有操作都有适当的Toast提示

### 6. 边界情况测试
1. **测试无档案情况**，验证显示"没有可用的档案"提示
2. **测试档案生成失败**，验证显示"无法生成预览"提示
3. **测试长文本处理**，验证预设资料过长时的显示效果
4. **测试快速切换**，验证快速点击不同档案时的响应

## 预期结果

### 成功标准
- ✅ AI按钮正常显示在输入框右边
- ✅ 点击AI按钮弹出档案选择器
- ✅ 档案选择器功能完整
- ✅ 预设资料预览正常显示
- ✅ 智能粘贴功能正常工作
- ✅ 各种插入选项都能正确执行
- ✅ 用户界面响应流畅
- ✅ 错误处理完善
- ✅ Toast提示信息准确

### 界面改进
- ✅ 添加了AI助手按钮
- ✅ 按钮样式与整体设计协调
- ✅ 布局间距合理
- ✅ 按钮图标清晰可见

## 技术实现要点

### 1. 智能粘贴逻辑
```kotlin
// 如果输入框为空，直接插入；如果有内容，询问用户
if (currentText.isBlank()) {
    // 输入框为空，直接插入预设资料
    browserSearchInput.setText(generatedPrompt)
    browserSearchInput.setSelection(browserSearchInput.text.length)
} else {
    // 输入框有内容，询问用户如何处理
    showBrowserPromptInsertionDialog(browserSearchInput, currentText, generatedPrompt, profile.name)
}
```

### 2. 预设资料预览
- 实时生成并显示档案的预设资料
- 支持错误处理和异常情况显示
- 预览区域可滚动查看长文本

### 3. 用户选择处理
- 提供4种插入选项：替换、追加、插入开头、取消
- 每种选项都有对应的用户反馈
- 光标位置根据选择进行适当调整

## 注意事项
1. 确保在测试前已创建至少一个AI助手档案
2. 测试时注意观察日志输出
3. 验证功能在深色模式和浅色模式下都正常工作
4. 测试不同长度的预设资料的处理效果

## 问题排查
如果遇到问题，请检查：
1. 档案配置是否正确
2. 预设资料生成是否正常
3. 输入框组件是否正确获取
4. 异常处理是否完善
5. 布局文件是否正确保存
6. 代码中是否有语法错误



