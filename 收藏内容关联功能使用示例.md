# æ”¶è—å†…å®¹å…³è”åŠŸèƒ½ä½¿ç”¨ç¤ºä¾‹

## ğŸ“š å¿«é€Ÿå¼€å§‹

### 1. æ·»åŠ å…³è”å…³ç³»

```kotlin
val collectionManager = UnifiedCollectionManager.getInstance(context)

// æ·»åŠ ä¸€ä¸ªå…³è”å…³ç³»ï¼ˆåŒå‘ï¼‰
collectionManager.addRelation(
    sourceId = "collection_1",
    targetId = "collection_2",
    relationType = RelationType.RELATED,
    note = "è¿™ä¸¤ä¸ªæ”¶è—é¡¹å†…å®¹ç›¸å…³",
    weight = 0.8f,
    bidirectional = true
)

// æ·»åŠ ä¾èµ–å…³ç³»
collectionManager.addRelation(
    sourceId = "collection_1",
    targetId = "collection_3",
    relationType = RelationType.DEPENDENCY,
    note = "collection_1ä¾èµ–äºcollection_3",
    bidirectional = false  // å•å‘å…³è”
)
```

### 2. æŸ¥è¯¢å…³è”çš„æ”¶è—é¡¹

```kotlin
// è·å–ç›´æ¥å…³è”çš„æ”¶è—é¡¹
val relatedItems = collectionManager.getRelatedCollections("collection_1")
relatedItems.forEach { (item, relation) ->
    println("å…³è”é¡¹: ${item.title}, ç±»å‹: ${relation.relationType.displayName}")
}

// è·å–æ‰€æœ‰å…³è”çš„æ”¶è—é¡¹ï¼ˆé€’å½’ï¼Œæ·±åº¦3ï¼‰
val allRelated = collectionManager.getAllRelatedCollections("collection_1", maxDepth = 3)

// è·å–æŒ‡å®šç±»å‹çš„å…³è”
val dependencies = collectionManager.getRelatedCollectionsByType(
    "collection_1",
    RelationType.DEPENDENCY
)
```

### 3. æ›´æ–°å…³è”å…³ç³»

```kotlin
// æ›´æ–°å…³è”ç±»å‹
collectionManager.updateRelationType(
    sourceId = "collection_1",
    targetId = "collection_2",
    newType = RelationType.REFERENCE,
    bidirectional = true
)

// æ›´æ–°å…³è”å¤‡æ³¨
collectionManager.updateRelationNote(
    sourceId = "collection_1",
    targetId = "collection_2",
    note = "æ›´æ–°åçš„å¤‡æ³¨è¯´æ˜"
)
```

### 4. ç§»é™¤å…³è”å…³ç³»

```kotlin
// ç§»é™¤å…³è”
collectionManager.removeRelation(
    sourceId = "collection_1",
    targetId = "collection_2",
    bidirectional = true
)
```

### 5. æ£€æµ‹å¾ªç¯å…³è”

```kotlin
// æ£€æµ‹æ˜¯å¦å­˜åœ¨å¾ªç¯å…³è”
val hasCycle = collectionManager.detectCircularRelation(
    sourceId = "collection_1",
    targetId = "collection_2"
)

if (hasCycle) {
    println("è­¦å‘Šï¼šæ·»åŠ æ­¤å…³è”ä¼šå½¢æˆå¾ªç¯")
}
```

### 6. æŸ¥æ‰¾å…³è”è·¯å¾„

```kotlin
// æŸ¥æ‰¾ä»collection_1åˆ°collection_5çš„è·¯å¾„
val path = collectionManager.getRelationPath(
    sourceId = "collection_1",
    targetId = "collection_5",
    maxDepth = 5
)

if (path != null) {
    println("è·¯å¾„: ${path.joinToString(" -> ")}")
} else {
    println("ä¸å­˜åœ¨è·¯å¾„")
}
```

### 7. åŸºäºæ ‡ç­¾è‡ªåŠ¨å‘ç°å…³è”

```kotlin
// åŸºäºå…±åŒæ ‡ç­¾æŸ¥æ‰¾ç›¸å…³æ”¶è—é¡¹
val relatedByTags = collectionManager.findRelatedByTags(
    itemId = "collection_1",
    minCommonTags = 2  // è‡³å°‘2ä¸ªå…±åŒæ ‡ç­¾
)
```

### 8. åŸºäºå†…å®¹ç›¸ä¼¼åº¦å‘ç°å…³è”

```kotlin
// åŸºäºå†…å®¹ç›¸ä¼¼åº¦æŸ¥æ‰¾ç›¸å…³æ”¶è—é¡¹
val relatedByContent = collectionManager.findRelatedByContent(
    itemId = "collection_1",
    similarityThreshold = 0.3f  // ç›¸ä¼¼åº¦é˜ˆå€¼30%
)

relatedByContent.forEach { (item, similarity) ->
    println("${item.title}: ç›¸ä¼¼åº¦ ${(similarity * 100).toInt()}%")
}
```

## ğŸ¨ å¯è§†åŒ–å±•ç¤º

### 1. ç”ŸæˆMermaidæµç¨‹å›¾

```kotlin
val generator = MermaidGraphGenerator()
val collections = collectionManager.getAllCollections()

// ä»æ”¶è—é¡¹ä¸­æå–å…³è”å…³ç³»
val relations = mutableListOf<CollectionRelationEntity>()
collections.forEach { item ->
    item.relations.forEach { relation ->
        relations.add(
            CollectionRelationEntity(
                sourceId = item.id,
                targetId = relation.targetId,
                relationType = relation.relationType,
                weight = relation.weight,
                note = relation.note
            )
        )
    }
}

// ç”Ÿæˆæµç¨‹å›¾
val flowchart = generator.generateFlowchart(
    collections = collections,
    relations = relations,
    rootId = "collection_1"  // å¯é€‰ï¼šæŒ‡å®šæ ¹èŠ‚ç‚¹
)

// ç”ŸæˆHTMLé¡µé¢
val html = generator.generateHtmlPage(flowchart, "æ”¶è—é¡¹å…³è”å›¾")
```

### 2. ç”Ÿæˆæ€ç»´å¯¼å›¾

```kotlin
val mindmap = generator.generateMindMap(
    rootId = "collection_1",
    collections = collections,
    relations = relations
)
```

### 3. ç”Ÿæˆå…³ç³»å›¾

```kotlin
val erDiagram = generator.generateEntityRelationshipDiagram(
    collections = collections,
    relations = relations
)
```

### 4. åœ¨Activityä¸­å±•ç¤º

```kotlin
// å¯åŠ¨Mermaidå›¾è¡¨Activity
val intent = Intent(context, MermaidGraphActivity::class.java).apply {
    putExtra(MermaidGraphActivity.EXTRA_ROOT_ID, "collection_1")
    putExtra(MermaidGraphActivity.EXTRA_GRAPH_TYPE, MermaidGraphActivity.TYPE_FLOWCHART)
}
startActivity(intent)
```

## ğŸ”„ å®Œæ•´ç¤ºä¾‹ï¼šåˆ›å»ºçŸ¥è¯†å›¾è°±

```kotlin
class KnowledgeGraphExample {
    
    fun createKnowledgeGraph(context: Context) {
        val manager = UnifiedCollectionManager.getInstance(context)
        
        // 1. åˆ›å»ºå‡ ä¸ªæ”¶è—é¡¹
        val item1 = UnifiedCollectionItem(
            title = "Androidå¼€å‘åŸºç¡€",
            content = "Androidå¼€å‘çš„åŸºç¡€çŸ¥è¯†...",
            collectionType = CollectionType.AI_REPLY,
            sourceLocation = "AIå¯¹è¯"
        )
        
        val item2 = UnifiedCollectionItem(
            title = "Kotlinè¯­è¨€ç‰¹æ€§",
            content = "Kotlinè¯­è¨€çš„ç‰¹æ€§ä»‹ç»...",
            collectionType = CollectionType.AI_REPLY,
            sourceLocation = "AIå¯¹è¯"
        )
        
        val item3 = UnifiedCollectionItem(
            title = "Androidæ¶æ„ç»„ä»¶",
            content = "ViewModelã€LiveDataç­‰...",
            collectionType = CollectionType.AI_REPLY,
            sourceLocation = "AIå¯¹è¯"
        )
        
        // 2. ä¿å­˜æ”¶è—é¡¹
        manager.addCollection(item1)
        manager.addCollection(item2)
        manager.addCollection(item3)
        
        // 3. å»ºç«‹å…³è”å…³ç³»
        // item1 åŒ…å« item2 å’Œ item3
        manager.addRelation(
            sourceId = item1.id,
            targetId = item2.id,
            relationType = RelationType.CONTAINS,
            note = "Androidå¼€å‘éœ€è¦äº†è§£Kotlin"
        )
        
        manager.addRelation(
            sourceId = item1.id,
            targetId = item3.id,
            relationType = RelationType.CONTAINS,
            note = "Androidå¼€å‘éœ€è¦äº†è§£æ¶æ„ç»„ä»¶"
        )
        
        // item2 æ˜¯ item3 çš„å‰ç½®æ¡ä»¶
        manager.addRelation(
            sourceId = item2.id,
            targetId = item3.id,
            relationType = RelationType.PREREQUISITE,
            note = "å­¦ä¹ æ¶æ„ç»„ä»¶å‰éœ€è¦äº†è§£Kotlin"
        )
        
        // 4. æŸ¥è¯¢å…³è”å…³ç³»
        val relatedToItem1 = manager.getRelatedCollections(item1.id)
        println("ä¸'${item1.title}'ç›¸å…³çš„æ”¶è—é¡¹:")
        relatedToItem1.forEach { (item, relation) ->
            println("  - ${item.title} (${relation.relationType.displayName})")
        }
        
        // 5. ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
        val generator = MermaidGraphGenerator()
        val allCollections = manager.getAllCollections()
        
        val relations = mutableListOf<CollectionRelationEntity>()
        allCollections.forEach { item ->
            item.relations.forEach { relation ->
                relations.add(
                    CollectionRelationEntity(
                        sourceId = item.id,
                        targetId = relation.targetId,
                        relationType = relation.relationType
                    )
                )
            }
        }
        
        val flowchart = generator.generateFlowchart(
            collections = allCollections,
            relations = relations,
            rootId = item1.id
        )
        
        // 6. åœ¨WebViewä¸­å±•ç¤º
        val html = generator.generateHtmlPage(flowchart, "çŸ¥è¯†å›¾è°±")
        // ... åŠ è½½åˆ°WebView
    }
}
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1ï¼šå­¦ä¹ ç¬”è®°å…³è”

```kotlin
// å°†ç›¸å…³çš„å­¦ä¹ ç¬”è®°å…³è”èµ·æ¥
manager.addRelation(
    sourceId = "note_android_basics",
    targetId = "note_kotlin_syntax",
    relationType = RelationType.PREREQUISITE,
    note = "å­¦ä¹ Androidå‰éœ€è¦å…ˆäº†è§£Kotlin"
)

manager.addRelation(
    sourceId = "note_android_basics",
    targetId = "note_android_advanced",
    relationType = RelationType.SEQUENCE,
    note = "åŸºç¡€ -> è¿›é˜¶"
)
```

### åœºæ™¯2ï¼šé¡¹ç›®æ–‡æ¡£å…³è”

```kotlin
// å°†é¡¹ç›®ç›¸å…³çš„æ–‡æ¡£å…³è”èµ·æ¥
manager.addRelation(
    sourceId = "doc_requirements",
    targetId = "doc_design",
    relationType = RelationType.SEQUENCE,
    note = "éœ€æ±‚ -> è®¾è®¡"
)

manager.addRelation(
    sourceId = "doc_design",
    targetId = "doc_implementation",
    relationType = RelationType.SEQUENCE,
    note = "è®¾è®¡ -> å®ç°"
)
```

### åœºæ™¯3ï¼šå¼•ç”¨å…³ç³»

```kotlin
// æ ‡è®°å¼•ç”¨å…³ç³»
manager.addRelation(
    sourceId = "article_1",
    targetId = "article_2",
    relationType = RelationType.REFERENCE,
    note = "å¼•ç”¨äº†article_2çš„å†…å®¹"
)
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ‰¹é‡æ“ä½œ**ï¼šå¦‚æœéœ€è¦æ·»åŠ å¤§é‡å…³è”ï¼Œè€ƒè™‘æ‰¹é‡å¤„ç†
2. **ç¼“å­˜**ï¼šå¯¹äºé¢‘ç¹æŸ¥è¯¢çš„å…³è”å…³ç³»ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜
3. **ç´¢å¼•**ï¼šå¦‚æœæ•°æ®é‡å¤§ï¼Œè€ƒè™‘ä½¿ç”¨æ•°æ®åº“ç´¢å¼•
4. **å¼‚æ­¥å¤„ç†**ï¼šå…³è”æŸ¥è¯¢å’Œå›¾è¡¨ç”Ÿæˆå¯ä»¥åœ¨åå°çº¿ç¨‹è¿›è¡Œ

## ğŸ” è°ƒè¯•æŠ€å·§

```kotlin
// æ‰“å°æ‰€æœ‰å…³è”å…³ç³»
fun debugRelations(manager: UnifiedCollectionManager) {
    val collections = manager.getAllCollections()
    collections.forEach { item ->
        println("æ”¶è—é¡¹: ${item.title}")
        item.relations.forEach { relation ->
            val target = manager.getCollectionById(relation.targetId)
            println("  -> ${target?.title} (${relation.relationType.displayName})")
        }
    }
}

// æ£€æµ‹æ‰€æœ‰å¾ªç¯å…³è”
fun detectAllCycles(manager: UnifiedCollectionManager) {
    val collections = manager.getAllCollections()
    collections.forEach { item ->
        item.relations.forEach { relation ->
            val hasCycle = manager.detectCircularRelation(item.id, relation.targetId)
            if (hasCycle) {
                println("å‘ç°å¾ªç¯: ${item.title} -> ${relation.targetId}")
            }
        }
    }
}
```







