# 临时专线显示修复测试指南

## 修复内容
将"临时专线"作为固定的常驻AI联系人添加到对话tab的"全部"分类中，使其与Kimi、智谱AI、DeepSeek同等地显示在对话列表中。

## 修复的具体问题
1. **问题**：用户无法在对话tab的"全部"分类下看到"临时专线"
2. **原因**：`isValidApiKey`方法没有对"临时专线"进行特殊处理，导致即使`isTempService`为true，"临时专线"仍然因为API密钥验证失败而被跳过
3. **解决方案**：
   - 修改`isValidApiKey`方法，对"临时专线"始终返回true
   - 添加`ensureTempServiceInContacts()`方法，确保"临时专线"始终存在于联系人列表中
   - 在`loadInitialContacts()`和`refreshChatContactsList()`方法中调用确保方法

## 测试步骤

### 1. 清理测试环境
```bash
# 清除应用数据，确保从干净状态开始测试
adb shell pm clear com.example.aifloatingball
```

### 2. 启动应用并检查对话tab
1. 启动应用
2. 点击底部导航栏的"对话"tab
3. 确认"全部"分类被选中（绿色高亮）
4. 检查对话列表中是否显示"临时专线"

### 3. 验证临时专线显示
**预期结果**：
- "临时专线"应该显示在对话列表的顶部（置顶状态）
- 显示名称："临时专线"
- 描述："免费AI服务 (无需API密钥)"
- 最后消息："你好！我是临时专线，有什么可以帮助你的吗？"
- 状态：在线（绿色圆点）

### 4. 测试临时专线对话功能
1. 点击"临时专线"联系人
2. 确认能正常进入对话界面
3. 发送一条测试消息，如"你好"
4. 确认能收到AI回复
5. 确认对话历史能正常保存

### 5. 测试重启后持久性
1. 完全关闭应用
2. 重新启动应用
3. 进入对话tab的"全部"分类
4. 确认"临时专线"仍然显示在列表中
5. 确认之前的对话历史仍然存在

### 6. 测试与其他AI的共存
**预期结果**：
- "临时专线"应该与Kimi、智谱AI、DeepSeek等AI助手一起显示
- 所有AI助手都应该能正常点击进入对话
- 排序应该按置顶状态和最后消息时间进行

## 验证要点

### 1. 显示验证
- [ ] "临时专线"在对话列表中可见
- [ ] 显示在"全部"分类中
- [ ] 置顶显示（在列表顶部）
- [ ] 显示正确的名称和描述

### 2. 功能验证
- [ ] 点击"临时专线"能正常进入对话界面
- [ ] 能正常发送和接收消息
- [ ] 对话历史能正常保存和加载

### 3. 持久性验证
- [ ] 应用重启后"临时专线"仍然显示
- [ ] 对话历史在重启后仍然存在
- [ ] 不会因为其他操作而消失

### 4. 兼容性验证
- [ ] 与其他AI助手能正常共存
- [ ] 不影响其他AI助手的显示和功能
- [ ] 不影响群聊功能的正常使用

## 技术实现细节

### 修改的方法
1. **`isValidApiKey()`**：添加对"临时专线"的特殊处理，始终返回true
2. **`generateDefaultContacts()`**：确保"临时专线"在生成默认联系人时被包含
3. **`ensureTempServiceInContacts()`**：新增方法，确保"临时专线"始终存在于联系人列表中
4. **`loadInitialContacts()`**：在加载联系人时调用确保方法
5. **`refreshChatContactsList()`**：在刷新联系人时调用确保方法

### 关键特性
- **固定常驻**：无论用户是否配置API密钥，"临时专线"都会显示
- **置顶显示**：`isPinned = true`，确保显示在列表顶部
- **无需配置**：不需要API密钥，直接可用
- **持久化**：数据会保存到SharedPreferences中

## 预期结果
修复完成后，用户应该能够在对话tab的"全部"分类中看到"临时专线"，点击后能正常进入对话界面，享受完整的AI对话体验，与Kimi、智谱AI、DeepSeek等AI助手具有同等的功能。

